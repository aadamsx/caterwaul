sdocp('test/ref.js.sdoc', 'Caterwaul ref library tests\n\ntest(function () {\n  var fn = caterwaul.clone(\'std\');\n  fn.foo = \'bar\';\n\n  var returned_this = fn(function (eq) {\n    eq(caterwaul.foo, \'bar\');\n    caterwaul.foo = \'bif\';\n    return caterwaul;\n  }) (eq);\n\n  fn.macro(fn.parse(\'foo\'), function () {return new this.ref(\'foo\')});\n  var macro_value = fn(function (eq) {\n    return foo;\n  }) (eq);\n  eq(macro_value, \'foo\');\n\n  fn.rmacro(fn.parse(\'bar\'), function () {return new this.ref(\'bar\')});\n  var rmacro_value = fn(function (eq) {\n    return bar;\n  }) (eq);\n  eq(rmacro_value, \'bar\');\n\n  var defmacro_value = fn(function (eq) {\n    defmacro[bif][fn_[new this.ref(\'bif\')]];\n    return bif;\n  }) (eq);\n  eq(defmacro_value, \'bif\');\n\n  eq(fn.foo, \'bif\');\n  eq(returned_this, fn);\n});\n');