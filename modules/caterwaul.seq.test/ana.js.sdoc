Anamorphism tests.

test(function () {
  var c = caterwaul.clone('seq');
  
  c(function (eq) {
    var xs = x + 1 <sa< [0];
    eq(xs.at(0), 0);
    eq(xs.finite_bound, 1);
    eq(xs[0], 0);
    eq(xs.length, Infinity);
    eq(xs.size(), Infinity);
    eq(xs.at(1), 1);
    eq(xs.finite_bound, 2);
    eq(xs.at(2), 2);
    eq(xs.finite_bound, 3);
    eq(xs.at(5), 5);
    eq(xs.finite_bound, 6);
  })(eq);

  c(function (eq) {
    var fibs = $(-1) + $(-2) <sa< [0, 1];
    eq(fibs.at(0), 0);
    eq(fibs.at(1), 1);
    eq(fibs.at(2), 1);
    eq(fibs.at(3), 2);

    eq(fibs.at(5), 5);
    eq(fibs.at(6), 8);
    eq(fibs.at(7), 13);

    eq(fibs[49], undefined);

    // Enforces memoization. Without it, this would take years:
    fibs.prepare(50);
    eq(fibs[49].constructor, Number);
    eq(fibs[50], undefined);
  })(eq);

  c(function (eq) {
    var evens = x + 2 <sa< [0];
    var xs = evens.force(10);
    eq(xs.length, 10);
    for (var i = 0, l = xs.length; i < l; ++i) eq(xs[i], i * 2);
  })(eq);
});
