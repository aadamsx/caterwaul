<!doctype html>
<html>
  <head>
    <title>Caterwaul Offline Compiler</title>
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
    <script src='../caterwaul.js'></script>
    <script src='../modules/caterwaul.opt.js'></script>
    <script src='../modules/caterwaul.format.js'></script>
    <script src='../modules/caterwaul.continuation.js'></script>
    <script src='../modules/caterwaul.seq.js'></script>
    <script src='http://spencertipping.com/montenegro/montenegro.client.js'></script>

    <script src='compiler.js'></script>

    <style>
      body {width: 900px; margin-left: auto; margin-right: auto; font-family: sans-serif; font-size: 10pt}
      h1, h2, h3, h4, h5, h6 {font-weight: normal; color: #f70}
      h1 {font-size: 16pt}
      h2 {font-size: 14pt}
      h3 {font-size: 10pt; color: #444}
      textarea {border: none; background: #eee; width: 440px; height: 5000px}
      li {color: #888; margin-bottom: 5px; color: #35a; cursor: pointer; font-family: monospace; font-weight: bold}
      li > code > a {color: #35a; text-decoration: none}
    </style>
  </head>
  <body>
    <h1>Caterwaul Offline Compiler</h1>
    <p>This compiler lets you preview macroexpansion. Here are some examples to get started (see <a href='http://spencertipping.com/caterwaul/caterwaul.html' target='_blank'>the Caterwaul
       documentation</a> for more information):</p>

    <h3>Standard macro library</h3>
    <ul><li>let[x = 5] in x + 2;</li>
        <li>fn[x][x + 1];</li>
        <li>fb[x][this(x)];</li>
        <li>fb_[this.method()];</li>
        <li>fn_[this];</li>
        <li>fc[x, y][this.x = x, this.y = y];</li>
        <li>fc_[this.x = ++count];</li>
        <li>x + y, where[x = 6, y = 10];</li>
        <li>x + y, where*[x = 6, y = 10];</li>
        <li>console.log(x), when[x &gt; 0];</li>
        <li>let*[x = 5, y = x] in x + y;</li>
        <li>let[f(x) = x + 1] in f(6);</li>
        <li>f(10)(20), where[f(x)(y) = x + y];</li>
        <li>f(10)(20), where*[f(x)(y) = x + y];</li>
        <li>console.log('The value is #{1 + 2 + 3}');</li>
        <li>var o = {} /se[_[k] = v];</li>
        <li>var o = {} /re[_[k] = v];</li>
        <li>[1, 2, 3].map(console/mb/log);</li>
        <li>[1, 2, 3].map(console/mb['log']);</li>
    </ul>

    <h3>Optimization macro library</h3>
    <ul><li>opt.unroll[x, 100][console.log(x)];</li>
    </ul>

    <h3>Continuation macro library</h3>
    <em>Note that these make heavy use of internal references, so the code they generate is fairly uninteresting.</em>
    <ul><li>call/cc[fn[cc][condition ? cc(5) : 6]];</li>
        <li>let*[f(n, a, k) = n &gt; 0 ? call/tail[f(n - 1, a * n, k)] : k(a)] in call/cc[fn[cc][f(5, 1, cc)]];</li>
        <li>let/cps[x &lt;- $.getJSON('/foo', _), y &lt;- $.getJSON('/foo/#{x}', _)][console.log('Got #{y}')];</li>
    </ul>

    <h3>Sequence macro library</h3>
    <ul><li>seq[xs *[_ + 1]];</li>
        <li>seq[xs *![console.log(_)]];</li>
        <li>seq[xs /[_ + _0]];</li>
        <li>seq[xs /![_ + _0]];</li>
        <li>seq[xs %[_ % 3 === 0]];</li>
        <li>seq[xs %![_ % 3]];</li>
        <li>seq[xs *n[n + 10]];</li>
        <li>seq[xs *!n[console.log(n)]];</li>
        <li>seq[xs *[_ + 1] %[_ % 3] /[_ + _0]];</li>
        <li>seq[xs &lt;&lt;[_ &lt; 100]];</li>
        <li>seq[xs &gt;&gt;[_ &lt; 100]];</li>
        <li>seq[xs + ys];</li>
        <li>seq[xs *[_ + 1] ^ ys %[_ &lt;= 10]];</li>
        <li>seq[xs *~[_ |[_ === 5]]];</li>
        <li>var naturals = seq[0 &gt;&gt;&gt;[_ + 1]];</li>
        <li>var primes = seq[2 &gt;&gt;&gt;[_ + 1]] /se[seq[_ %~n[_ &lt;&lt;[_ &lt;= Math.sqrt(n)] &amp;[n % _]]]];</li>
        <li>var first_few_primes = seq[primes &lt;&lt;[_ &lt; 100]];</li>
    </ul>

    <div>
      <h2>Compiler options</h2>
      <div><label for='minify'>Condensed output</label><input type='checkbox' id='minify'/></div>
      <div><label for='inspect'>Inspect structure</label><input type='checkbox' id='inspect'/></div>
      <div><label for='gensyms'>Simple gensyms</label><input type='checkbox' checked='checked' id='gensyms'/></div>
    </div>

    <div>
      <h2>Enabled modules</h2>
      <div><label for='std'>Standard macros ('std' module)</label><input type='checkbox' checked='checked' id='std'/></div>
      <div><label for='opt'>Optimization macros ('opt' module)</label><input type='checkbox' checked='checked' id='opt'/></div>
      <div><label for='continuation'>Continuation macros ('continuation' module)</label><input type='checkbox' checked='checked' id='continuation'/></div>
      <div><label for='seq'>Sequence macros ('seq' module)</label><input type='checkbox' checked='checked' id='seq'/></div>
      <div><label for='montenegro'>Montenegro client macros ('montenegro' module)</label><input type='checkbox' id='montenegro'/></div>
    </div>
    <table>
      <tr><td><h2>Source</h2><textarea id='code'></textarea></td>
          <td><h2>Compiled</h2><textarea id='output' readonly='yes'></textarea></td></tr>
    </table>
  </body>
</html>
