<!doctype html>
<html>
  <head>
    <title>Caterwaul Offline Compiler</title>
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
    <script src='../caterwaul.min.js'></script>
    <script src='../modules/caterwaul.opt.min.js'></script>
    <script src='../modules/caterwaul.format.min.js'></script>

    <script>
      $(caterwaul.clone('std')(function () {
        var c = caterwaul.clone('std', 'opt', 'format');

        let[parse_errors_for = function (code) {try {return ! new Function(code)} catch (e) {return e}},
                   serialize = fn[tree][$('#minify').is(':checked') ? tree.serialize() : c.format(tree)],
            create_caterwaul = fn_[let[c1 = $('#std').is(':checked') ? caterwaul.clone('std') : caterwaul.clone()] in
                                   (let[c2 = $('#opt').is(':checked') ? c1.configure('opt') : c1] in c2)]] in
        (let[recompile = fn_[$('#output').val(let[code = $('#code').val(), c = create_caterwaul()] in (code && (parse_errors_for(code) || serialize(c.expand(c.parse(code)).tree))) || '')]] in
         ($('#code').keyup(let[timeout = null] in fn_[timeout && clearTimeout(timeout), timeout = setTimeout(recompile, 200)]),
          $('input').change(recompile)));
      }));
    </script>

    <style>
      body {width: 900px; margin-left: auto; margin-right: auto}
      textarea {border: none; background: #eee; width: 440px; height: 5000px}
    </style>
  </head>
  <body>
    <table>
      <tr><td><label for='minify'>Condensed output</label><input type='checkbox' id='minify'/>
              <label for='std'>Include 'std'</label><input type='checkbox' checked='checked' id='std'/>
              <label for='opt'>Include 'opt'</label><input type='checkbox' checked='checked' id='opt'/></td></tr>
      <tr><td><textarea id='code'></textarea></td>
          <td><textarea id='output' readonly='yes'></textarea></td></tr>
    </table>
  </body>
</html>
