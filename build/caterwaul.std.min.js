caterwaul.module("std.macro",function(c){var b=function(e){var d=function(f){if(f.constructor===Array){for(var h=0,g=f.length,j=[];h<g;++h){j.push(d(f[h]))}return function(k){for(var l=j.length-1,m;
l>=0;--l){if(m=j[l].call(this,k)){return m}}}}else{return f.constructor===String?d(c.parse(f)):f.constructor===c.syntax?e.call(this,f):f}};return d};c.pattern=b(function(d){return function(e){return d.match(e)
}});c.expander=b(function(d){return function(e){return d.replace(e)}});c.alternatives=b(function(d){throw new Error("must use replacer functions with caterwaul.alternatives()")
});c.reexpander=function(f){var d=c.expander(f);return function(e){var g=d.call(this,e);return g&&this(g)}};var a=function(d){return function(f,h){var g=c.pattern(f),e=d(h);
return function(i){var j=g.call(this,i);return j&&e.call(this,j)}}};c.replacer=a(c.expander);c.rereplacer=a(c.reexpander);c.macroexpand=function(d){return c(c.alternatives(Array.prototype.slice.call(arguments,1)))(d)
}});caterwaul.module("std.anon",function(a){a.anonymizer=function(){for(var d={},c=0,b=arguments.length;c<b;++c){d[arguments[c]]=a.gensym(arguments[c])}return function(e){return a.parse(e).replace(d)
}}});caterwaul.module("std.js",function(a){a.js=function(c){var f=function(I){var Q=I.data,F=Q.charAt(0),K=a.syntax;if(F!=="'"&&F!=='"'||!/#\{[^\}]+\}/.test(Q)){return false
}for(var J=[],R=[],M=1,L=Q.length-1,P=0,N=false,G=1,O;M<L;++M){if(P){if((O=Q.charAt(M))==="}"){--P||(J.push(Q.substring(G,M)),R.push(true))&&(G=M+1),N=false}else{P+=O==="{"
}}else{if((O=Q.charAt(M))==="#"){N=true}else{if(O==="{"&&N){J.push(Q.substring(G,M-1)),R.push(false),G=M+1,++P}else{N=false}}}}J.push(Q.substring(G,L)),R.push(false);
for(var H=new RegExp("\\\\"+F,"g"),M=0,L=J.length;M<L;++M){J[M]=R[M]?this(a.parse(J[M].replace(H,F)).as("(")):new K(F+J[M]+F)}return new K("+",J).unflatten().as("(")
};var B=a.parse("var _x = _y"),E=a.parse("_x = _y"),y=a.parse("result"),D=a.parse("function (_formals) {_befores; var result = _result; _afters; return result}"),z=a.parse("function (_formals) {_befores; return _result}"),g=a.parse("_f = _x"),A=function(F){return F.is_empty()&&F.data==="result"
},p=a.rereplacer("_f(_xs) = _y",function(O){for(var P=[],T=[],U=[],F=O._xs.flatten(","),N=0,L=F.length;N<L;++N){(U.length||F[N].contains(A)?U:T.length||F[N].length?T:P).push(F[N])
}for(var K=[T,U],N=0,L=K.length;N<L;++N){for(var J=K[N],M=0,R=J.length,I;M<R;++M){J[M]=(I=E.match(J[M]))&&I._x.is_empty()?B.replace(I):J[M].as("(")}}var Q=P.length?new a.syntax(",",P).unflatten():a.empty,H=T.length?new a.syntax(";",T).unflatten():a.empty,G=U.length?new a.syntax(";",U).unflatten():a.empty,S=g.replace({_f:O._f,_x:U.length?D:z});
return S.replace({_formals:Q,_befores:H,_afters:G,_result:O._y})});var q=function(G){var I=G.data,H,F;if((I==="/"||I==="|")&&(H=G[0]).data===I&&H[1]&&H[1].data==="u-"&&(F=H[1][0])){return new a.syntax("()",F,this(G[0][0]).flatten(I).push(this(G[1])).with_data(",").unflatten())
}};var x=function(I){var K=I.data,J,H;if((K==="/"||K==="|")&&(J=I[0]).data===K&&J[1]&&J[1].data==="u~"&&(H=J[1][0])){var G=[].slice.call(this(I[0][0]).flatten(K)),F=G.shift();
return new a.syntax("()",new a.syntax(".",new a.syntax("(",F),H),new a.syntax(",",G,this(I[1])).unflatten())}};var l=a.parse("_f(_x)"),h=a.rereplacer("_x /!_f",function(F){return l.replace({_f:F._f,_x:this(F._x).flatten("/").with_data(",").unflatten()})
});var j=a.pattern("_literal._modifier"),w=function(G,H,F){var I=G.literal_modifiers[H];return I.hasOwnProperty(F)&&I[F]},n=function(H){var G=j.call(this,H),F,I;
if(G&&(F=G._literal)&&(I=F.is_identifier()?w(this,"identifier",G._modifier.data):F.is_array()?w(this,"array",G._modifier.data):F.is_regexp()?w(this,"regexp",G._modifier.data):F.is_number()?w(this,"number",G._modifier.data):F.is_string()?w(this,"string",G._modifier.data):null)){return I.call(this,F)
}};var s=a.pattern("_modifier[_expression]"),i=a.pattern("_expression /_modifier"),u=a.pattern("_expression -_modifier"),C=a.pattern("_modifier in _expression"),r=a.pattern("_expression |_modifier"),t=a.pattern("_expression, _modifier"),o=a.pattern("_modifier._parameters"),k=a.pattern("_modifier[_parameters]"),v=a.pattern("_expression <_modifier> _parameters"),e=a.pattern("_expression -_modifier- _parameters"),b=function(K){var F,G=v.call(this,K)||e.call(this,K);
if(G&&this.parameterized_modifiers.hasOwnProperty(F=G._modifier.data)){var J=this.parameterized_modifiers[F].call(this,G);if(J){return J}}var I=s.call(this,K)||i.call(this,K)||u.call(this,K)||C.call(this,K)||r.call(this,K)||t.call(this,K);
if(I){var H=o.call(this,I._modifier)||k.call(this,I._modifier);if(H){I._modifier=H._modifier;I._parameters=H._parameters;return this.parameterized_modifiers.hasOwnProperty(F=I._modifier.data)&&this.parameterized_modifiers[F].call(this,I)
}else{return this.modifiers.hasOwnProperty(F=I._modifier.data)&&this.modifiers[F].call(this,I)}}};var d=function(F){return f.call(this,F)||n.call(this,F)||F.length&&(b.call(this,F)||p.call(this,F)||q.call(this,F)||x.call(this,F)||h.call(this,F))
},m=c?a(function(F){return c.call(this,F)||d.call(this,F)}):a(d);m.modifiers={};m.parameterized_modifiers={};m.literal_modifiers={regexp:{},array:{},string:{},number:{},identifier:{}};
return m}});caterwaul.module("std.js-literals",function(a){a.js_literals=function(c){var b=a.parse("function (_) {return _body}");(function(d){d.x=a.reexpander(function(f){return f.with_data(f.data.replace(/\s+/g,""))
});var e=a.parse("_regexp.exec(_)");d.qf=function(f){return b.replace({_body:e.replace({_regexp:f})})}})(c.literal_modifiers.regexp);(function(d){d.qw=a.reexpander(function(k){for(var m=new a.syntax("["),e=new a.syntax(","),g=k.data.charAt(0),j=k.as_escaped_string().split(/\s+/),h=0,f=j.length;
h<f;++h){e.push(new a.syntax(g+j[h]+g))}return m.push(e.unflatten())});d.qh=a.reexpander(function(k){for(var m=new a.syntax("{"),e=new a.syntax(","),g=k.data.charAt(0),j=k.as_escaped_string().split(/\s+/),h=0,f=j.length;
h<f;h+=2){e.push(new a.syntax(":",new a.syntax(g+j[h]+g),new a.syntax(g+j[h+1]+g)))}return m.push(e.unflatten())});d.qr=a.reexpander(function(e){return e.with_data("/"+e.as_escaped_string().replace(/\//g,"\\/")+"/")
});d.qs=function(e){return new a.ref(a.parse(e.as_unescaped_string()))};d.qf=a.reexpander(function(e){return b.replace({_body:a.parse(e.as_unescaped_string())})})
})(c.literal_modifiers.string);return c}});caterwaul.module("std.words",function($){var scope_template=$.parse("(function () {var _variables; return (_expression)}).call(this)"),trivial_node_template=$.parse("new caterwaul.syntax(_data)"),nontrivial_node_template=$.parse("new caterwaul.syntax(_data, _xs)");
$.words=function(caterwaul_function){$.merge(caterwaul_function.modifiers,$.words.modifiers);$.merge(caterwaul_function.parameterized_modifiers,$.words.parameterized_modifiers);
return caterwaul_function};$.syntax_to_expression=function(tree){if(tree.length){for(var comma=new $.syntax(","),i=0,l=tree.length;i<l;++i){comma.push($.syntax_to_expression(tree[i]))
}return nontrivial_node_template.replace({_data:'"'+tree.data.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"',_xs:comma.unflatten()})}else{return trivial_node_template.replace({_data:'"'+tree.data.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"'})
}};$.words.modifiers={qs:function(match){return new $.expression_ref($.syntax_to_expression(match._expression),"qs")},qse:function(match){return new $.expression_ref($.syntax_to_expression(this(match._expression)),"qse")
},reexpand:function(match){return this(this(match._expression))},noexpand:function(match){return match._expression},raise:$.reexpander("(function () {throw _expression}).call(this)"),eval:function(match){return new $.ref($.compile(this(match._expression)),"eval")
},delay:$.reexpander("(function (t, f) {return (function () {return f.call(t)})})(this, (function () {return _expression}))"),lazy:$.reexpander("(function (t, f, v, vc) {return (function () {return vc ? v : (vc = true, v = f.call(t))})})(this, (function () {return _expression}))"),capture:function(match){for(var comma=new $.syntax(","),bindings=match._expression.flatten(","),i=0,l=bindings.length;
i<l;++i){comma.push(this(bindings[i]).with_data(":"))}return new $.syntax("{",comma.unflatten())},wcapture:function(match){for(var e=this(match._expression),comma=new $.syntax(","),bindings=e.flatten(","),node,i=0,l=bindings.length;
i<l;++i){(node=this(bindings[i]))[1]=node[0],comma.push(node.with_data(":"))}return scope_template.replace({_variables:e,_expression:new $.syntax("{",comma.unflatten())})
}};$.words.parameterized_modifiers={given:$.reexpander("(function (_parameters) {return _expression})"),bgiven:$.reexpander("(function (t, f) {return (function () {return f.apply(t, arguments)})})(this, (function (_parameters) {return _expression}))"),rescue:$.reexpander("(function () {try {return (_expression)} catch (e) {return (_parameters)}}).call(this)"),se:$.reexpander("(function (it) {return (_parameters), it}).call(this, (_expression))"),re:$.reexpander("(function (it) {return (_parameters)}).call(this, (_expression))"),where:$.reexpander("(function () {var _parameters; return (_expression)}).call(this)"),using:$.reexpander(function(match){var m=this(match._parameters),o=$.compile(m),comma=new $.syntax(","),expression_ref=new $.expression_ref(m);
for(var k in o){Object.prototype.hasOwnProperty.call(o,k)&&/^[_$a-zA-Z][_$0-9a-zA-Z]*$/.test(k)&&!this.modifiers.hasOwnProperty(k)&&!this.parameterized_modifiers.hasOwnProperty(k)&&comma.push(new $.syntax("=",k,new $.syntax(".",expression_ref,k)))
}return scope_template.replace({_variables:comma.unflatten(),_expression:match._expression})}),when:$.reexpander("((_parameters) && (_expression))"),and:$.reexpander("((_expression) && (_parameters))"),unless:$.reexpander("(! (_parameters) && (_expression))"),or:$.reexpander("((_expression) || (_parameters))")}
});caterwaul.module("std.seq",function(a){(function(){var d=a.anonymizer("S"),e=function(g,f){return a.rereplacer(g.constructor===String?d(g):g,f.constructor===String?d(f):f)
},b=(function(){var s=a.anonymizer("x","y","i","j","l","lj","r","o","k"),h=d("(function (_xs) {var _x, _x0, _xi, _xl, _xr; _body}).call(this, S[_s])"),K=function(N){return h.replace({_body:N})
},f=function(N){return N.replace(/@/g,"Array.prototype.slice.call").replace(/#/g,"Object.prototype.hasOwnProperty.call").replace(/%%/g,".constructor")},i=function(N){return s(K(d(f(N))))
},J=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length; _xi < _xl; ++_xi) _x = _xs[_xi], _xr.push((_f));               return _xr"),m=i("for (var                    _xi = 0, _xl = _xs.length; _xi < _xl; ++_xi) _x = _xs[_xi], (_f);                         return _xs"),E=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length; _xi < _xl; ++_xi) _x = _xs[_xi], _xr.push.apply(_xr, @((_f))); return _xr"),r=i("for (var _x = _xs, _xi = 0, _x0, _xl;              _x0 = (_init); ++_xi) _x = (_f);                                   return _x"),v=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0;     _xi < _xl; ++_xi) _x = _xs[_xi], (_f) && _xr.push(_x);        return _xr"),k=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0;     _xi < _xl; ++_xi) _x = _xs[_xi], (_f) || _xr.push(_x);        return _xr"),g=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0, _y; _xi < _xl; ++_xi) _x = _xs[_xi], (_y = (_f)) && _xr.push(_y); return _xr"),l=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0; _xi < _xl; ++_xi) _x = _xs[_xi], (_x0 = (_init)) && _xr.push(_f); return _xr"),L=i("for (var _x0 = _xs[0], _xi = 1, _xl = _xs.length;            _xi < _xl; ++_xi) _x = _xs[_xi], _x0 = (_f); return _x0"),G=i("for (var _xl = _xs.length, _xi = _xl - 2, _x0 = _xs[_xl - 1]; _xi >= 0; --_xi) _x = _xs[_xi], _x0 = (_f); return _x0"),w=i("for (var _xr = [], _x = _xs, _xi = 0;                      _x !== null; ++_xi) _xr.push(_x), _x = (_f);   return _xr"),F=i("for (var _x0 = (_init), _xi = 0, _xl = _xs.length;      _xi < _xl; ++_xi) _x = _xs[_xi], _x0 = (_f);     return _x0"),D=i("for (var _xl = _xs.length - 1, _xi = _xl, _x0 = (_init); _xi >= 0; --_xi) _x = _xs[_xi], _x0 = (_f);     return _x0"),C=i("for (var _xr = [], _x = _xs, _xi = 0, _x0;          _x0 = (_init); ++_xi) _xr.push(_x), _x = (_f);       return _xr"),B=i("for (var _x = _xs[0], _xi = 0, _xl = _xs.length, x; _xi < _xl; ++_xi) {_x = _xs[_xi]; if (x = (_f)) return x} return false"),u=i("for (var _x = _xs[0], _xi = 0, _xl = _xs.length, x; _xi < _xl; ++_xi) {_x = _xs[_xi]; if (x = (_f)) return false} return true"),q=d("(S[_xs]).concat((S[_ys]))"),H=i("for (var _xr = (S[_ys]), pairs = [], i = 0, l = _xs.length; i < l; ++i) pairs.push([_xs[i], _xr[i]]); return pairs"),j=i("for (var _xr = (S[_ys]), pairs = [], i = 0, l = _xs.length, lj = _xr.length; i < l; ++i) for (var j = 0; j < lj; ++j) pairs.push([_xs[i], _xr[j]]);return pairs"),I=i("var _xr = new _xs%%();  for (var _x in _xs) if (#(_xs, _x)) _xr[_f] = _xs[_x]; return _xr"),n=i("                        for (var _x in _xs) if (#(_xs, _x)) _f;                return _xs"),A=i("var _xr = new _xs%%();    for (var _x in _xs) if (#(_xs, _x) &&      (_f))  _xr[_x] = _xs[_x]; return _xr"),p=i("var _xr = new _xs%%();    for (var _x in _xs) if (#(_xs, _x) &&    ! (_f))  _xr[_x] = _xs[_x]; return _xr"),z=i("var _xr = new _xs%%(), x; for (var _x in _xs) if (#(_xs, _x) && (x = (_f))) _xr[x]  = _xs[_x]; return _xr"),x=i("var _xr = new _xs%%();    for (var  k in _xs) if (#(_xs, k)) _x = _xs[k], _xr[k] = (_f); return _xr"),M=i("                          for (var  k in _xs) if (#(_xs, k)) _x = _xs[k], _f;            return _xs"),t=i("var _xr = new _xs%%();    for (var  k in _xs) if (#(_xs, k)) _x = _xs[k],        (_f) && (_xr[k] = _x); return _xr"),o=i("var _xr = new _xs%%();    for (var  k in _xs) if (#(_xs, k)) _x = _xs[k],        (_f) || (_xr[k] = _x); return _xr"),y=i("var _xr = new _xs%%(), x; for (var  k in _xs) if (#(_xs, k)) _x = _xs[k], x = (_f), x && (_xr[k] =  x); return _xr");
return((function(){var ap=function(aq){return(function(){throw new Error(aq)}).call(this)},ac=function(at,ar,aq,av,au){return at?at.replace({_f:aq,_init:av}).replace(a.merge({_s:ar},au)):ap(("unsupported sequence operator or modifiers used on "+(aq)+""))
},U=function(aq){return function(ar){return(function(){var av=ar._xs,ax=this,aw=function(ay){return function(az,aA){return ac(ay,av,az,null,aA)}},au=function(ay){return function(az,aB,aA){return ac(ay,av,az,aB,aA)
}},at=function(ay,az){return function(aA){return am(aA,ax,aw(ay),au(az))}};return(Y(ar._thing,at(aq.normal,aq.inormal),at(aq.bang,aq.ibang),at(aq.tbang,aq.itbang)))
}).call(this)}},af=U({normal:J,bang:m,tbang:E,itbang:r}),ai=U({normal:v,bang:k,tbang:g,itbang:l}),ad=U({normal:L,bang:G,tbang:w,inormal:F,ibang:D,itbang:C}),V=U({normal:I,bang:n}),ag=U({normal:A,bang:p,tbang:z}),W=U({normal:x,bang:M}),ae=U({normal:t,bang:o,tbang:y}),N=U({normal:B,bang:u}),T=d("[_x]"),Z=d("_var[_x]"),al=d("[_init][_x]"),ah=d("_var[_init][_x]"),P=d("+_x"),ak=d("~_x"),R={_x:"x",_x0:"x0",_xi:"xi",_xl:"xl",_xs:"xs",_xr:"xr"},aj=function(aq){return{_x:aq,_x0:(""+(aq)+"0"),_xi:(""+(aq)+"i"),_xl:(""+(aq)+"l"),_xs:(""+(aq)+"s"),_xr:(""+(aq)+"r")}
},ao=d("(_f).call({_x0: _x0, _xi: _xi, _xl: _xl, _xs: _xs, _xr: _xr}, _x)"),X=function(aq){return ao.replace({_f:aq})},O=d("(function (_x, _x0, _xi, _xl, _xs, _xr) {return _f}).call(this, _x, _x0, _xi, _xl, _xs, _xr)"),S=function(ar,aq){return O.replace(ar).replace({_f:aq})
},an=d("S[_x]"),ab=function(aq){return an.replace({_x:aq})},am=function(aq,ar,at,au){return(function(){var av=function(aB){return ar.call(ar,ab(aB))},az=function(aB,aC){return at(av(aB),aC)
},ay=function(aC,aB,aD){return au(av(aC),aB,aD)},aA=function(aB,aC){return at(S(aC,aB),aC)},aw=function(aC,aB,aD){return au(S(aD,aC),aB,aD)},ax=null;return(((ax=ak.match(aq))?am(ax._x,ar,az,ay):(ax=P.match(aq))?am(ax._x,ar,aA,aw):(ax=ah.match(aq))?au(ax._x,ax._init,aj(ax._var)):(ax=al.match(aq))?au(ax._x,ax._init,R):(ax=Z.match(aq))?at(ax._x,aj(ax._var)):(ax=T.match(aq))?at(ax._x,R):at(X(aq),R)))
}).call(this)},Q=d("~!_x"),aa=d("!_x"),Y=function(aq,at,ar,au){return(function(){var av=null;return(((av=Q.match(aq))?au(av._x):(av=aa.match(aq))?ar(av._x):at(aq)))
}).call(this)};return([e("S[_x]","_x"),e("S[_xs + _ys]",q),e("S[_xs ^ _ys]",H),e("S[_xs - _ys]",j),e("S[(_x)]","(S[_x])"),e("S[_x[_y]]","S[_x][_y]"),e("S[_xs(_ys)]","S[_xs](_ys)"),e("S[[_x]]","[_x]"),e("S[_x, _y]","S[_x], S[_y]"),e("S[_xs._p]","S[_xs]._p"),e("S[~[_x]]","[S[_x]]"),e("S[~_xs(_ys)]","S[_xs](S[_ys])"),e("S[_x ? _y : _z]","(S[_x]) ? (S[_y]) : (S[_z])"),e("S[_x && _y]","(S[_x]) && (S[_y])"),e("S[_x || _y]","(S[_x]) || (S[_y])"),e("S[+_xs]","Array.prototype.slice.call((_xs))"),e("S[_xs %_thing]",ai),e("S[_xs *_thing]",af),e("S[_xs /_thing]",ad),e("S[_xs |_thing]",N),e("S[_xs %k*_thing]",V),e("S[_xs %v*_thing]",W),e("S[_xs %k%_thing]",ag),e("S[_xs %v%_thing]",ae)])
}).call(this))}).call(this),c=(function(){var i=function(n){return j.replace(a.merge({_lower:"0",_step:"1"},n))},h=function(n){return k.replace(a.merge({_lower:"0",_step:"1"},n))
},j=d("(function (i, u, s) {if ((u - i) * s <= 0) return [];for (var r = [], d = u - i; d > 0 ? i <  u : i >  u; i += s) r.push(i); return r})((_lower), (_upper), (_step))"),k=d("(function (i, u, s) {if ((u - i) * s <= 0) return [];for (var r = [], d = u - i; d > 0 ? i <= u : i >= u; i += s) r.push(i); return r})((_lower), (_upper), (_step))"),q=d("(function (o) {_body}).call(this, (S[_o]))"),m=function(n){return q.replace({_body:n})
},g=function(n){return(function(){var r=m(d(n));return((function(s){return r.replace(s)}))}).call(this)},p=g("var ks = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ks.push(k); return ks"),o=g("var vs = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && vs.push(o[k]); return vs"),f=g("var ps = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ps.push([k, o[k]]); return ps"),l=g("for (var r = {}, i = 0, l = o.length, x; i < l; ++i) x = o[i], r[x[0]] = x[1]; return r");
return([e("S[n[_upper]]",i),e("S[ni[_upper]]",h),e("S[_o /keys]",p),e("S[_o |object]",l),e("S[n[_lower, _upper]]",i),e("S[ni[_lower, _upper]]",h),e("S[_o /values]",o),e("S[_o -object]",l),e("S[n[_lower, _upper, _step]]",i),e("S[ni[_lower, _upper, _step]]",h),e("S[_o /pairs]",f),e("S[_o /object]",l)])
}).call(this);return(a.seq=function(f){return(function(){var h=d("S[_x]"),g=a(a.alternatives(b.concat(c)));return((function(i){return(i.modifiers.seq=function(j){return(function(k){return(((k)&&(this(k))))
}).call(this,(g.call(g,h.replace({_x:j._expression}))))}),i}).call(this,(f)))}).call(this)})}).call(this)});caterwaul.module("std",function(a){a.js_all=function(){return this("js js_literals words seq")
}});