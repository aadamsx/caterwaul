(caterwaul.std_initializer=function(){(function(c){var b=function(g){var d=function(h){if(h.constructor===Array){for(var k=0,j=h.length,o=[];k<j;++k){o.push(d(h[k]))}return function(l){for(var q=o.length-1,s;q>=0;--q){if(s=o[q].call(this,l)){return s}}}}else{return h.constructor===String?d(c.parse(h)):h.constructor===c.syntax?g.call(this,h):h}};return d};c.pattern=b(function(d){return function(g){return d.match(g)}});c.expander=b(function(d){return function(g){return d.replace(g)}});c.alternatives=b(function(d){throw new Error("must use replacer functions with caterwaul.alternatives()")});c.reexpander=function(g){var d=c.expander(g);return function(h){var i=d.call(this,h);return i&&this(i)}};var a=function(d){return function(h,j){var i=c.pattern(h),g=d(j);return function(k){var l=i.call(this,k);return l&&g.call(this,l)}}};c.replacer=a(c.expander);c.rereplacer=a(c.reexpander);c.macroexpand=function(d){return c(c.alternatives(Array.prototype.slice.call(arguments,1)))(d)}})(caterwaul);(function(a){a.anonymizer=function(){for(var d={},c=0,b=arguments.length;c<b;++c){d[arguments[c]]=a.gensym(arguments[c])}return function(g){return a.parse(g).replace(d)}}})(caterwaul);(function(a){a.js=function(w){var i=function(C){var K=C.data,z=K.charAt(0),E=a.syntax;if(z!=="'"&&z!=='"'||!/#\{[^\}]+\}/.test(K)){return false}for(var D=[],L=[],G=1,F=K.length-1,J=0,H=false,A=1,I;G<F;++G){if(J){if((I=K.charAt(G))==="}"){--J||(D.push(K.substring(A,G)),L.push(true))&&(A=G+1),H=false}else{J+=I==="{"}}else{if((I=K.charAt(G))==="#"){H=true}else{if(I==="{"&&H){D.push(K.substring(A,G-1)),L.push(false),A=G+1,++J}else{H=false}}}}D.push(K.substring(A,F)),L.push(false);for(var B=new RegExp("\\\\"+z,"g"),G=0,F=D.length;G<F;++G){D[G]=L[G]?this(a.parse(D[G].replace(B,z)).as("(")):new E(z+D[G]+z)}return new E("+",D).unflatten().as("(")};var g=a.rereplacer("_left(_args) = _right","_left = (function (_args) {return _right})"),d=a.rereplacer("_left(_var = arguments) = _right","_left = (function () {var _var = arguments; return _right})"),k=function(z){return d.call(this,z)||g.call(this,z)};var l=a.pattern("_modifier[_expression]"),q=a.pattern("_expression /_modifier"),v=a.pattern("_expression -_modifier"),j=a.pattern("_modifier in _expression"),b=a.pattern("_expression |_modifier"),h=a.pattern("_expression, _modifier"),s=a.pattern("_modifier._parameters"),o=a.pattern("_modifier[_parameters]"),u=a.pattern("_expression <_modifier> _parameters"),r=a.pattern("_expression -_modifier- _parameters"),c=function(E){var z=u.call(this,E)||r.call(this,E);if(z){for(var F=this.parameterized_modifiers,C=F.length-1,D;C>=0;--C){if(D=F[C].call(this,z)){return D}}}var B=l.call(this,E)||q.call(this,E)||v.call(this,E)||j.call(this,E)||b.call(this,E)||h.call(this,E);if(B){var A=s.call(this,B._modifier)||o.call(this,B._modifier);if(A){B._modifier=A._modifier;B._parameters=A._parameters;for(var F=this.parameterized_modifiers,C=F.length-1,D;C>=0;--C){if(D=F[C].call(this,B)){return D}}}else{for(var F=this.modifiers,C=F.length-1,D;C>=0;--C){if(D=F[C].call(this,B)){return D}}}}};var y=w?a(function(z){return w.call(this,z)||i.call(this,z)||z.length&&(c.call(this,z)||k.call(this,z))}):a(function(z){return i.call(this,z)||z.length&&(c.call(this,z)||k.call(this,z))});y.modifiers=[];y.parameterized_modifiers=[];return y}})(caterwaul);(function(a){a.words=function(c){var g=function(h,i){return function(j){return j._modifier.data===h&&i.call(this,j)}},b=function(h,i){c.modifiers.push(g(h,i))},d=function(h,i){c.parameterized_modifiers.push(g(h,i))};b("qs",function(h){return new a.ref(h._expression,"qs")});b("qse",function(h){return new a.ref(this(h._expression),"qse")});b("reexpand",function(h){return this(this(h._expression))});b("noexpand",function(h){return h._expression});b("raise",a.reexpander("(function () {throw _expression}).call(this)"));d("rescue",a.reexpander("(function () {try {return (_expression)} catch (e) {return (_parameters)}}).call(this)"));d("given",a.reexpander("(function (_parameters) {return _expression})"));d("bgiven",a.reexpander("(function (t, f) {return (function () {return f.apply(t, arguments)})})(this, (function (_parameters) {return _expression}))"));b("delay",a.reexpander("(function (t, f) {return (function () {return f.call(t)})})(this, (function () {return _expression}))"));b("lazy",a.reexpander("(function (t, f, v, vc) {return (function () {return vc ? v : (vc = true, v = f.call(t))})})(this, (function () {return _expression}))"));d("se",a.reexpander("(function (it) {return (_parameters), it}).call(this, (_expression))"));d("re",a.reexpander("(function (it) {return (_parameters)}).call(this, (_expression))"));d("where",a.reexpander("(function () {var _parameters; return (_expression)}).call(this)"));d("when",a.reexpander("((_parameters) && (_expression))"));d("unless",a.reexpander("(! (_parameters) && (_expression))"));return c}})(caterwaul);caterwaul.words(caterwaul.js())(function(a){a.seq(caterwaul_function)=caterwaul_function-se-it.modifiers.push(given.match in seq_expand.call(seq_expand,anon_pattern.replace({_x:match._expression}))-re-this(it)/when.it-when[match._modifier.data==="seq"])-where[anon_pattern=anon("S[_x]"),seq_expand=a(a.alternatives(operator_macros.concat(word_macros)))],where[anon=a.anonymizer("S"),rule(p,e)=a.rereplacer(p.constructor===String?anon(p):p,e.constructor===String?anon(e):e),operator_macros=[rule("S[_x]","_x"),rule("S[(_x)]","(S[_x])"),rule("S[_x[_y]]","S[_x][S[_y]]"),rule("S[[_x]]","[S[_x]]"),rule("S[_x, _y]","S[_x], S[_y]"),operator("","|",{"":exists}),operator("","*",{"":map,"!":each,"~!":flatmap}),binary_operator("+",concat),binary_operator("^",zip),operator("","%",{"":filter,"!":filter_not,"~!":map_filter}),binary_operator("-",cross),operator("","/",{"":foldl,"!":foldr,"~!":unfold,i:ifoldl,"i!":ifoldr}),operator("k","*",{"":kmap,"!":keach}),operator("v","*",{"":vmap,"!":veach}),operator("k","%",{"":kfilter,"!":kfilter_not,"~1":kmap_filter}),operator("v","%",{"":vfilter,"!":vfilter_not,"~!":vmap_filter})]-where[uses_x0={"/":true},binary_operator(op,f)=rule(anon("S[_xs #{op} _ys]"),f),operator(prefix,op,forms)=[generic(given.m in [rule("S[_xs #{pop}#{m}_f]","S[_xs #{pop}#{m}[_f(#{args})]]"),rule("S[_xs #{pop}#{m}~_f]",e.replace({_body:this(wrap(match._f))})-given.match-where[wrapper=anon("S[_x]"),wrap(x)=wrapper.replace({_x:x}),e=anon("S[_xs #{pop}#{m}_body]")])]),generic(given.m in rule([anon("S[_xs #{pop}#{m}[_f]"),anon("S[_xs #{pop}#{m}_var[_f]]")],forms[m]||fail)),generic(given.m in rule([anon("S[_xs #{pop}#{m}[_init][_f]"),anon("S[_xs #{pop}#{m}_var[_init][_f]]")],forms["i#{m}"]||fail))]-where[generic(f)=[f(""),f("!"),f("~!")],fail=anon('(function () {throw new Error("undefined sequence form")})()'),pop=(prefix&&"%#{prefix}")+op,args=uses_x0[op]?"x, x0":"x"]]-where[loop_anon=a.anonymizer("xs","ys","x","y","i","j","l","lj","r","o","k"),loop_form(x)=loop_anon(scoped(anon(x))),scope=anon("(function (xs) {_body}).call(this, S[_xs])"),scoped(tree)=scope.replace({_body:tree}),op_form(pattern)=form.replace(variables_for(match))-given.match-where[form=loop_form(pattern)],map=op_form("for (var ys = [], _xi = 0, _xl = xs.length, _x; _xi < _xl; ++_xi) _x = xs[_xi], ys.push((_f));                                 return ys"),each=op_form("for (var          _xi = 0, _xl = xs.length, _x; _xi < _xl; ++_xi) _x = xs[_xi], (_f);                                          return xs"),flatmap=op_form("for (var ys = [], _xi = 0, _xl = xs.length, _x; _xi < _xl; ++_xi) _x = xs[_xi], ys.push.apply(ys, ys.slice.call((_f)));        return ys"),filter=op_form("for (var ys = [], _xi = 0, _xl = xs.length, _x; _xi < _xl; ++_xi) _x = xs[_xi], (_f) && ys.push(_x);                           return ys"),filter_not=op_form("for (var ys = [], _xi = 0, _xl = xs.length, _x; _xi < _xl; ++_xi) _x = xs[_xi], (_f) || ys.push(_x);                           return ys"),map_filter=op_form("for (var ys = [], _xi = 0, _xl = xs.length, _x, _y; _xi < _xl; ++_xi) _x = xs[_xi], (_y = (_f)) && ys.push(_y);                return ys"),foldl=op_form("for (var _x0 = xs[0], _xi = 1, _xl = xs.length, _x;            _xi < _xl; ++_xi) _x = xs[_xi], _x0 = (_f);                     return _x0"),foldr=op_form("for (var _xl = xs.length - 1, _xi = _xl - 1, _x0 = xs[_xi], _x; _xi >= 0; --_xi) _x = xs[_xi], _x0 = (_f);                     return _x0"),unfold=op_form("for (var ys = [], _x = xs, _xi = 0;                          _x !== null; ++_xi) ys.push(_x), _x = (_f);                       return ys"),ifoldl=op_form("for (var _x0 = (_init), _xi = 0, _xl = xs.length, _x;      _xi < _xl; ++_xi) _x = xs[_xi], _x0 = (_f);                         return _x0"),ifoldr=op_form("for (var _xl = xs.length - 1, _xi = _xl, _x0 = (_init), _x; _xi >= 0; --_xi) _x = xs[_xi], _x0 = (_f);                         return _x0"),exists=op_form("for (var _x = xs[0], _xi = 0, _xl = xs.length, x; _xi < _xl; ++_xi) {_x = xs[_xi]; if (y = (_f)) return y} return false"),concat=op_form("return xs.concat(S[_ys])"),zip=op_form("for (var ys = S[_ys], pairs = [], i = 0, l = xs.length; i < l; ++i) pairs.push([xs[i], ys[i]]); return pairs"),cross=op_form("for (var ys = S[_ys], pairs = [], i = 0, l = xs.length, lj = ys.length; i < l; ++i) for (var j = 0; j < lj; ++j) pairs.push([xs[i], ys[j]]);return pairs"),kmap=op_form("var r = {};        for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x)) r[_f] = xs[_x];                        return r"),keach=op_form("                   for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x)) _f;                                    return xs"),kfilter=op_form("var r = {};        for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x) &&      (_f))  r[_x] = xs[_x];          return r"),kfilter_not=op_form("var r = {};        for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x) &&    ! (_f))  r[_x] = xs[_x];          return r"),kmap_filter=op_form("var r = {}, x;     for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x) && (x = (_f))) r[x]  = xs[_x];          return r"),vmap=op_form("var r = {}, _x;    for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k], r[k] = (_f);                return r"),veach=op_form("var _x;            for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k], _f;                         return xs"),vfilter=op_form("var r = {}, _x;    for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k],        (_f) && (r[k] = _x); return r"),vfilter_not=op_form("var r = {}, _x;    for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k],        (_f) || (r[k] = _x); return r"),vmap_filter=op_form("var r = {}, _x, x; for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k], x = (_f), x && (r[k] =  x); return r"),variables_for(m)=a.merge({},m,prefixed_hash(m._var)),prefixed_hash(p)={_x:name,_xi:"#{name}i",_xl:"#{name}l",_x0:"#{name}0"}-where[name=p&&p.data||"x"]],word_macros=[rule("S[n[_upper]]",n),rule("S[_o /keys]",keys),rule("S[_o |object]",object),rule("S[n[_lower, _upper]]",n),rule("S[_o /values]",values),rule("S[_o -object]",object),rule("S[n[_lower, _upper, _step]]",n),rule("S[_o /pairs]",pairs),rule("S[_o /object]",object)]-where[n(match)=n_pattern.replace(a.merge({_lower:"0",_step:"1"},match)),n_pattern=anon("(function (i, u, s) {if ((u - i) * s <= 0) return [];for (var r = [], d = u - i; d > 0 ? i < u : i > u; i += s) r.push(i); return r})((_lower), (_upper), (_step))"),scope=anon("(function (o) {_body}).call(this, (S[_o]))"),scoped(t)=scope.replace({_body:t}),form(p)=tree.replace(match)-given.match-where[tree=scoped(anon(p))],keys=form("var ks = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ks.push(k); return ks"),values=form("var vs = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && vs.push(o[k]); return vs"),pairs=form("var ps = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ps.push([k, o[k]]); return ps"),object=form("for (var r = {}, i = 0, l = o.length, x; i < l; ++i) x = o[i], r[x[0]] = x[1]; return r")]]})(caterwaul);caterwaul.js_all=function(){return this.seq(this.words(this.js()))}})();