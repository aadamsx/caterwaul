caterwaul.macro_form('adverb','modified_adverb',function (name,def,form,gensym_1_gmrw9frv_4ingc7){this.macro(form.replace({it:name}),def)});
caterwaul.macro_form('adjective','modified_adjective',function (name,def,form,gensym_1_gmrw9frv_4ingc8){this.macro(form.replace({it:name}),def)});
caterwaul.configuration('core.js',function (gensym_1_gmrw9frv_4ingc9){this.adjective_form('it[_expression]','_expression |it','_expression /it').modified_adverb_form('it[_modifiers][_expression]','it[_modifiers] in _expression','it._modifiers[_expression]','it._modifiers in _expression','_expression, it[_modifiers]','_expression |it[_modifiers]','_expression /it[_modifiers]','_expression -it[_modifiers','_expression -it- _modifiers','_expression, it._modifiers','_expression |it._modifiers','_expression /it._modifiers','_expression -it._modifiers','_expression <it> _modifiers');
this.macro('_string',function (match,gensym_1_gmrw9frv_4ingca){var s=match._string.data,q=s.charAt(0);
if (q!=='\''&&q!=='"'|| !/#\{[^\}]+\}/.test(s))return false;
for (var pieces=[],i=1,l=s.length-1,brace_depth=0,got_hash=false,start=1,c;
i<l;
 ++i)if (brace_depth)if ((c=s.charAt(i))==='}') --brace_depth||pieces.push(s.substring(start,i))&&(start=i+1),got_hash=false;
else brace_depth+=c==='{';
else if ((c=s.charAt(i))==='#')got_hash=true;
else if (c==='{'&&got_hash)pieces.push(s.substring(start,i-1)),start=i+1, ++brace_depth;
else got_hash=false;
pieces.push(s.substring(start,l));
for (var escaped=new RegExp('\\\\'+q,'g'),i=0,l=pieces.length;
i<l;
 ++i)if (i&1)pieces[i]=this.parse(pieces[i].replace(escaped,q)).as('(');
else pieces[i]=new this.syntax(q+pieces[i]+q);
return new this.syntax('+',pieces).unflatten().as('(')});
this.macro('_left(_args) = _right','_left = (function (_args) {return _right})')});
caterwaul.configuration('core.quote',function (gensym_1_gmrw9frv_4ingcb){this.adjective('qs',function (match,gensym_1_gmrw9frv_4ingcc){return new this.ref(match._expression)}).adjective('qse',function (match,gensym_1_gmrw9frv_4ingcd){return new this.ref(this.macroexpand(match._expression))})});
caterwaul.configuration('core.words',function (gensym_1_gmrw9frv_4ingce){this.modified_adverb('given','from','fn','(function (_modifiers) {return _expression})').modified_adverb('bgiven','bfrom','fb','(function (t, f) {return (function () {return f.apply(t, arguments)})})(this, (function (_modifiers) {return _expression}))');
this.modified_adverb('effect','se','(function (it) {return (_modifiers), it}).call(this, (_expression))').modified_adverb('then','re','returning','(function (it) {return (_modifiers)}).call(this, (_expression))');
this.modified_adverb('where','bind','(function () {var _modifiers; return (_expression)}).call(this)');
this.modified_adverb('when','((_modifiers) && (_expression))').modified_adverb('unless','(! (_modifiers) && (_expression))').modified_adverb('otherwise','((_expression) || (_modifiers))');
this.modified_adverb('over',this.with_gensyms('(function () {for (var gensym_xs = (_modifiers), gensym_result = [], gensym_i = 0, gensym_l = gensym_xs.length, it; gensym_i < gensym_l; ++gensym_i) '+'  it = gensym_xs[gensym_i], gensym_result.push(_expression); return gensym_result}).call(this)')).modified_adverb('over_keys',this.with_gensyms('(function () {var gensym_x = (_modifiers), gensym_result = []; '+'for (var it in gensym_x) Object.prototype.hasOwnProperty.call(gensym_x, it) && gensym_result.push(_expression); return gensym_result}).call(this)')).modified_adverb('over_values',this.with_gensyms('(function () {var gensym_x = (_modifiers), gensym_result = [], it; '+'for (var gensym_k in gensym_x) Object.prototype.hasOwnProperty.call(gensym_x, gensym_k) && (it = gensym_x[gensym_k], gensym_result.push(_expression));'+'return gensym_result}).call(this)'));
this.modified_adverb('until',this.with_gensyms('(function () {var gensym_result = []; while (! (_modifiers)) gensym_result.push(_expression); return gensym_result}).call(this)'))});
caterwaul.tconfigure('core.js core.words core.quote',caterwaul.precompiled_internal((function (){var gensym_1_gmrw9frv_4ingd8=caterwaul.parse('function (_args,gensym_1_gmrw9frv_4ingch){_body}');
var gensym_1_gmrw9frv_4ingd9=caterwaul.parse('function (gensym_1_gmrw9frv_4ingci){_body}');
var gensym_1_gmrw9frv_4ingda=caterwaul.parse('function (_args,_gensym,gensym_1_gmrw9frv_4ingcj){_body}');
var gensym_1_gmrw9frv_4ingdb=caterwaul.parse('function (_gensym,gensym_1_gmrw9frv_4ingck){_body}');
var gensym_1_gmrw9frv_4ingdc=caterwaul.parse('function (_args,_gensym,gensym_1_gmrw9frv_4ingcl){_body}');
var gensym_1_gmrw9frv_4ingdd=caterwaul.parse('function (_gensym,gensym_1_gmrw9frv_4ingcm){_body}');
var gensym_1_gmrw9frv_4ingde=caterwaul.parse('caterwaul.precompiled_internal(_x)');
var gensym_1_gmrw9frv_4ingdf=caterwaul.parse('(function (gensym_1_gmrw9frv_4ingco){_vars;\nreturn (_value)})()');
var gensym_1_gmrw9frv_4ingdg=caterwaul.parse('null');
var gensym_1_gmrw9frv_4ingdh=caterwaul.parse('caterwaul.parse(_string)');
var gensym_1_gmrw9frv_4ingdi=caterwaul.parse('caterwaul.clone(_string)');
return (function (gensym_1_gmrw9frv_4ingcf){( !(this.init_not_precompiled)&&((function (){var original=this.init;
return (this.method('init_not_precompiled',original).method('init',(function (f,environment){return this.is_precompiled(f)||this.init_not_precompiled(f,environment)})))}).call(this)));
this.field('precompiled_internal_table',{}).method('precompiled_internal',(function (f){return (function (){var k=this.gensym();
return ((function (it){return (this.precompiled_internal_table[k]=f),it}).call(this,(k)))}).call(this)})).method('is_precompiled',(function (f){return ((f.constructor===String)&&(this.precompiled_internal_table[f]))})).method('precompile',(function (gensym_1_gmrw9frv_4ingcg){return (function (){var nontrivial_function_pattern=gensym_1_gmrw9frv_4ingd8,trivial_function_pattern=gensym_1_gmrw9frv_4ingd9,nontrivial_function_gensym_template=gensym_1_gmrw9frv_4ingda,trivial_function_gensym_template=gensym_1_gmrw9frv_4ingdb,function_macro_generator=(function (template){return (function (references){return (function (match){return (function (){var s=caterwaul.gensym(),result=template.replace({_args:match._args,_gensym:s,_body:annotate_functions_in(match._body,references)});
return ((function (it){return (references[s]={tree:result}),it}).call(this,(result)))}).call(this)})})}),mark_nontrivial_function_macro=function_macro_generator(nontrivial_function_gensym_template),mark_trivial_function_macro=function_macro_generator(trivial_function_gensym_template),annotate_functions_in=(function (tree,references){return caterwaul.macro_expand_naive(tree,[trivial_function_pattern,nontrivial_function_pattern],[mark_trivial_function_macro(references),mark_nontrivial_function_macro(references)],null)}),nontrivial_gensym_detection_pattern=gensym_1_gmrw9frv_4ingdc,trivial_gensym_detection_pattern=gensym_1_gmrw9frv_4ingdd,wrapped_compile=(function (original,references){return function (tree,environment,gensym_1_gmrw9frv_4ingcn){var matches=nontrivial_gensym_detection_pattern.match(tree)||trivial_gensym_detection_pattern.match(tree),k=matches&&matches._gensym.data;
if (matches&&references[k])if (references[k].compiled)throw new Error('detected multiple compilations of '+references[k].tree.serialize());
else references[k].compiled=tree,references[k].environment=caterwaul.merge({},this.globals,environment);
return original.call(this,tree,environment)}}),signal_already_compiled=(function (tree){return gensym_1_gmrw9frv_4ingde.replace({_x:tree})}),closure_template=gensym_1_gmrw9frv_4ingdf,closure_variable_template=caterwaul.parse('var _var = _value'),closure_null_template=gensym_1_gmrw9frv_4ingdg,syntax_ref_string=(function (ref){return '\''+ref.serialize().replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/'/g,'\\\'')+'\''}),caterwaul_ref_string=(function (has){return '\''+(function (){var gensym_1_gmrw9frv_4ingd2=(has),gensym_1_gmrw9frv_4ingd3=[];
for (var it in gensym_1_gmrw9frv_4ingd2)Object.prototype.hasOwnProperty.call(gensym_1_gmrw9frv_4ingd2,it)&&gensym_1_gmrw9frv_4ingd3.push(it);
return gensym_1_gmrw9frv_4ingd3}).call(this)+'\''}),serialize_ref=function (value,name,seen,gensym_1_gmrw9frv_4ingcp){if ( !value)return ''+value;
else if (value.constructor===caterwaul.syntax)return seen[value.id()]||(seen[value.id()]=name,gensym_1_gmrw9frv_4ingdh.replace({_string:syntax_ref_string(value)}));
else if (value.is_caterwaul===is_caterwaul)return seen[value.id()]||(seen[value.id()]=name,gensym_1_gmrw9frv_4ingdi.replace({_string:caterwaul_ref_string(value.has)}));
else throw new Error('syntax ref value is not serializable: '+value)},variables_for=function (tree,environment,globals,gensym_1_gmrw9frv_4ingcq){var names=[],values=[],seen={};
for (var k in environment)if (Object.prototype.hasOwnProperty.call(environment,k))names.push(k),values.push(serialize_ref(environment[k],k,seen));
tree.reach(function (n,gensym_1_gmrw9frv_4ingcr){if (n&&n.binds_a_value)names.push(n.data),values.push(serialize_ref(n.value,n.data,seen))});
for (var vars=[],i=0,l=names.length;
i<l;
 ++i)vars.push(closure_variable_template.replace({_var:names[i],_value:values[i]}));
return names.length?new caterwaul.syntax(';',vars):closure_null_template},precompiled_closure=(function (tree,environment){return closure_template.replace({_vars:variables_for(tree,environment),_value:tree})}),precompiled_function=(function (tree,environment){return signal_already_compiled(precompiled_closure(tree,environment))}),substitute_precompiled=(function (references){return (function (match){return (function (){var ref=references[match._gensym.data];
return (((ref&&ref.compiled)&&(precompiled_function(ref.compiled,ref.environment))))}).call(this)})}),perform_substitution=(function (references,tree){return (function (){var expander=substitute_precompiled(references);
return (caterwaul.macro_expand_naive(tree,[trivial_gensym_detection_pattern,nontrivial_gensym_detection_pattern],[expander,expander],null))}).call(this)}),annotated_caterwaul=(function (caterwaul,references){return caterwaul.clone().method('compile',wrapped_compile(caterwaul.compile,references))}),trace_execution=(function (caterwaul,f){return (function (){var references={},annotated=references.annotated=annotate_functions_in(caterwaul.parse(f),references);
return ((function (it){return (references)}).call(this,(caterwaul.compile(annotated,{caterwaul:annotated_caterwaul(caterwaul,references)})())))}).call(this)});
return ((function (f){return (function (){var references=trace_execution(this,f);
return (this.compile(perform_substitution(references,references.annotated)))}).call(this)}))}).call(this)})())})})()));
caterwaul.configuration('core.trace',function (gensym_1_gmrw9frv_4ingcs){this.after(this.trace.clone())}).shallow('trace',caterwaul.clone().tconfigure('core.js core.words core.quote',caterwaul.precompiled_internal((function (){var gensym_1_gmrw9frv_4ingdu=caterwaul.parse('_before_hook(_tree),_after_hook(_tree,_expression)');
var gensym_1_gmrw9frv_4ingdv=caterwaul.parse('_before_hook(_tree),_after_hook(_tree,_object,_method,[_parameters])');
var gensym_1_gmrw9frv_4ingdw=caterwaul.parse('_x=_y');
var gensym_1_gmrw9frv_4ingdx=caterwaul.parse('H[all,_x=E[_y]]');
var gensym_1_gmrw9frv_4ingdy=caterwaul.parse('_x[_y]=_z');
var gensym_1_gmrw9frv_4ingdz=caterwaul.parse('H[all,E[_x][E[_y]]=E[_z]]');
var gensym_1_gmrw9frv_4inge0=caterwaul.parse('_x._y=_z');
var gensym_1_gmrw9frv_4inge1=caterwaul.parse('H[all,E[_x]._y=E[_z]]');
var gensym_1_gmrw9frv_4inge2=caterwaul.parse('_x+_y');
var gensym_1_gmrw9frv_4inge3=caterwaul.parse('H[all,E[_x]+E[_y]]');
var gensym_1_gmrw9frv_4inge4=caterwaul.parse(' +_x');
var gensym_1_gmrw9frv_4inge5=caterwaul.parse('H[all, +T[_x]]');
return (function (gensym_1_gmrw9frv_4ingct){(function (){var self=this,qw=(function (s){return s.split(/\s+/)}),trace_directive_aliases=(function (it){return ((function (){var o=it;
return ((function (){var gensym_1_gmrw9frv_4ingdo=(o),gensym_1_gmrw9frv_4ingdp=[];
for (var it in gensym_1_gmrw9frv_4ingdo)Object.prototype.hasOwnProperty.call(gensym_1_gmrw9frv_4ingdo,it)&&gensym_1_gmrw9frv_4ingdp.push(o[o[it]]=it);
return gensym_1_gmrw9frv_4ingdp}).call(this))}).call(this)),it}).call(this,((function (it){return ((function (){var o=it;
return ((function (){for (var gensym_1_gmrw9frv_4ingdk=(qw('I D H S E')),gensym_1_gmrw9frv_4ingdl=[],gensym_1_gmrw9frv_4ingdm=0,gensym_1_gmrw9frv_4ingdn=gensym_1_gmrw9frv_4ingdk.length,it;
gensym_1_gmrw9frv_4ingdm<gensym_1_gmrw9frv_4ingdn;
 ++gensym_1_gmrw9frv_4ingdm)it=gensym_1_gmrw9frv_4ingdk[gensym_1_gmrw9frv_4ingdm],gensym_1_gmrw9frv_4ingdl.push(o[it]=this.gensym());
return gensym_1_gmrw9frv_4ingdl}).call(this))}).call(this)),it}).call(this,({})))),convert_trace_directives_in=(function (tree){return self.ensure_syntax(tree).replace(trace_directive_aliases)}),with_tmacro=(function (){return this.method('tmacro',(function (lhs,rhs){return this.final_macro(lhs,convert_trace_directives_in(rhs))}))}),statement=this.clone(with_tmacro),expression=this.clone(with_tmacro),trace_directive_expander=this.clone(),before_hook=(function (tree){return self.before_trace(tree)}),after_hook=(function (tree,value){return (function (it){return (value)}).call(this,(self.after_trace(tree,value)))}),after_method_hook=(function (tree,object,method,parameters){return (function (){var resolved=object[method];
return ((function (it){return (after_hook(tree,resolved.apply(object,parameters)))}).call(this,((function (it){return (self.after_trace(tree[0],resolved))}).call(this,(self.before_trace(tree[0]))))))}).call(this)}),before_hook_ref=new this.ref(before_hook),after_hook_ref=new this.ref(after_hook),after_method_hook_ref=new this.ref(after_method_hook),expression_hook_template=gensym_1_gmrw9frv_4ingdu.as('('),expression_hook=(function (original,tree){return expression_hook_template.replace({_before_hook:before_hook_ref,_after_hook:after_hook_ref,_tree:new self.ref(original),_expression:tree.as('(')})}),indirect_method_hook_template=gensym_1_gmrw9frv_4ingdv.as('('),quote_method_name=(function (method){return ('"'+(method.data.replace(/"/g,"\\\""))+'"')}),method_hook=(function (tree,object,method,parameters){return indirect_method_hook_template.replace({_before_hook:before_hook_ref,_after_hook:after_method_hook_ref,_tree:new self.ref(tree),_object:object,_method:method,_parameters:parameters})}),direct_method_hook=(function (tree,match){return method_hook(tree,match._object,quote_method_name(match._method),match._parameters)}),indirect_method_hook=(function (tree,match){return method_hook(tree,match._object,match._method,match._parameters)});
return (this.event('before_trace','after_trace'),this.shallow('expression',expression.after(trace_directive_expander).configure(function (gensym_1_gmrw9frv_4ingcu){this.method('assignment_operator',(function (op){return this.tmacro(gensym_1_gmrw9frv_4ingdw.replace({'=':op}),gensym_1_gmrw9frv_4ingdx.replace({'=':op})).tmacro(gensym_1_gmrw9frv_4ingdy.replace({'=':op}),gensym_1_gmrw9frv_4ingdz.replace({'=':op})).tmacro(gensym_1_gmrw9frv_4inge0.replace({'=':op}),gensym_1_gmrw9frv_4inge1.replace({'=':op}))})).method('binary_operator',(function (op){return this.tmacro(gensym_1_gmrw9frv_4inge2.replace({'+':op}),gensym_1_gmrw9frv_4inge3.replace({'+':op}))})).method('unary_operator',(function (op){return this.tmacro(gensym_1_gmrw9frv_4inge4.replace({'u+':('u'+(op)+'')}),gensym_1_gmrw9frv_4inge5.replace({'u+':('u'+(op)+'')}))})),this.tmacro('_x','H[_x, _x]').tmacro('(_x)','(E[_x])').tmacro('++_x','H[all, ++_x]').tmacro('--_x','H[all, --_x]').tmacro('_x++','H[all, _x++]').tmacro('_x--','H[all, _x--]').tmacro('_x, _y','E[_x], E[_y]').tmacro('_x._y','H[all, E[_x]._y]').tmacro('_o._m(_xs)','D[all, E[_o], _m, [E[_xs]]]').tmacro('_o[_m](_xs)','I[all, E[_o], E[_m], [E[_xs]]]').tmacro('typeof _x','H[all, typeof _x]').tmacro('delete _x._y','H[all, delete E[_x]._y]').tmacro('new _x(_y)','H[all, new H[_x](E[_y])]').tmacro('{_ps}','H[all, {E[_ps]}]').tmacro('_k: _v','_k: E[_v]').tmacro('[_xs]','H[all, [E[_xs]]]').tmacro('_x ? _y : _z','H[all, E[_x] ? E[_y] : E[_z]]').tmacro('function (_xs) {_body}','H[all, function (_xs) {S[_body]}]'),(function (){for (var gensym_1_gmrw9frv_4ingdk=(qw('= += -= *= /= %= &= |= ^= <<= >>= >>>=')),gensym_1_gmrw9frv_4ingdl=[],gensym_1_gmrw9frv_4ingdm=0,gensym_1_gmrw9frv_4ingdn=gensym_1_gmrw9frv_4ingdk.length,it;
gensym_1_gmrw9frv_4ingdm<gensym_1_gmrw9frv_4ingdn;
 ++gensym_1_gmrw9frv_4ingdm)it=gensym_1_gmrw9frv_4ingdk[gensym_1_gmrw9frv_4ingdm],gensym_1_gmrw9frv_4ingdl.push(this.assignment_operator(it));
return gensym_1_gmrw9frv_4ingdl}).call(this),(function (){for (var gensym_1_gmrw9frv_4ingdk=(qw('() [] + - * / % < > <= >= == != === !== in instanceof ^ & | && ||')),gensym_1_gmrw9frv_4ingdl=[],gensym_1_gmrw9frv_4ingdm=0,gensym_1_gmrw9frv_4ingdn=gensym_1_gmrw9frv_4ingdk.length,it;
gensym_1_gmrw9frv_4ingdm<gensym_1_gmrw9frv_4ingdn;
 ++gensym_1_gmrw9frv_4ingdm)it=gensym_1_gmrw9frv_4ingdk[gensym_1_gmrw9frv_4ingdm],gensym_1_gmrw9frv_4ingdl.push(this.binary_operator(it));
return gensym_1_gmrw9frv_4ingdl}).call(this),(function (){for (var gensym_1_gmrw9frv_4ingdk=(qw('+ - void')),gensym_1_gmrw9frv_4ingdl=[],gensym_1_gmrw9frv_4ingdm=0,gensym_1_gmrw9frv_4ingdn=gensym_1_gmrw9frv_4ingdk.length,it;
gensym_1_gmrw9frv_4ingdm<gensym_1_gmrw9frv_4ingdn;
 ++gensym_1_gmrw9frv_4ingdm)it=gensym_1_gmrw9frv_4ingdk[gensym_1_gmrw9frv_4ingdm],gensym_1_gmrw9frv_4ingdl.push(this.unary_operator(it));
return gensym_1_gmrw9frv_4ingdl}).call(this)})),this.shallow('statement',statement.after(trace_directive_expander).configure(function (gensym_1_gmrw9frv_4ingcv){this.tmacro('_x','E[_x]').tmacro('for (_x) _y','for (S[_x]) S[_y]').tmacro('{_x}','{S[_x]}').tmacro('for (_x; _y; _z) _body','for (S[_x]; E[_y]; E[_z]) S[_body]').tmacro('_x; _y','S[_x]; S[_y]').tmacro('while (_x) _y','while (E[_x]) S[_y]').tmacro('do _x; while (_y)','do S[_x]; while (E[_y])').tmacro('function _f(_args) {_body}','function _f(_args) {S[_body]}').tmacro('do {_x} while (_y)','do {S[_x]} while (E[_y])').tmacro('_x, _y','S[_x], S[_y]').tmacro('_x = _y','_x = E[_y]').tmacro('try {_x} catch (_e) {_y}','try {S[_x]} catch (_e) {S[_y]}').tmacro('var _xs','var S[_xs]').tmacro('try {_x} catch (_e) {_y} finally {_z}','try {S[_x]} catch (_e) {S[_y]} finally {S[_z]}').tmacro('const _xs','const S[_xs]').tmacro('try {_x} finally {_y}','try {S[_x]} finally {S[_y]}').tmacro('if (_x) _y','if (E[_x]) S[_y]').tmacro('return _x','return E[_x]').tmacro('if (_x) _y; else _z','if (E[_x]) S[_y]; else S[_z]').tmacro('return','return').tmacro('if (_x) {_y} else _z','if (E[_x]) {S[_y]} else S[_z]').tmacro('throw _x','throw E[_x]').tmacro('break _label','break _label').tmacro('switch (_c) {_body}','switch (E[_c]) {S[_body]}').tmacro('break','break').tmacro('with (_x) _y','with (E[_x]) S[_y]').tmacro('continue _label','continue _label').tmacro('continue','continue').tmacro('_label: _stuff','_label: S[_stuff]')})),this.shallow('trace_directive_expander',trace_directive_expander.configure(function (gensym_1_gmrw9frv_4ingcw){this.method('tmacro',(function (lhs,rhs){return this.macro(convert_trace_directives_in(lhs),rhs)})).tmacro('H[_tree, _x]',(function (match){return expression_hook(match._tree,match._x)})).tmacro('D[_tree, _object, _method, [_parameters]]',(function (match){return direct_method_hook(match._tree,match)})).tmacro('I[_tree, _object, _method, [_parameters]]',(function (match){return indirect_method_hook(match._tree,match)})).tmacro('E[_x]',(function (match){return expression(match._x)})).tmacro('S[_x]',(function (match){return statement(match._x)}))})),this.final_macro('_x',(function (match){return statement(match._x)})),this.self_variable=self,this.on_bake((function (invocation){return (function (it){return (trace_directive_expander.bake())}).call(this,((function (it){return (statement.bake())}).call(this,(expression.bake()))))})))}).call(this)})})())));
