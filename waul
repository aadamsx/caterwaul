#!/usr/bin/env node

// Waul: the offline precompiler for Caterwaul | Spencer Tipping
// Licensed under the terms of the MIT source code license

// Introduction.
// Caterwaul is useful as a library and an online compiler, but when performance is important you probably want to deliver precompiled code. Waul is a program that does exactly that. You write a
// regular file that invokes Caterwaul on a function, and Waul emits a Javascript file that contains the Caterwaul-compiled results. For example:

// | $ cat > test.waul <<EOF
//   caterwaul('js_all')(function ($) {
//     console.log('#{message} from caterwaul!')
//     -where [message = 'hello']})(caterwaul);
//   EOF
//   $ waul test.waul
//   $ node test.js
//   hello from caterwaul!
//   $

// Waul has some limitations:

// | 1. It cannot precompile any macros that generate refs (this includes the -eval- modifier, unfortunately, though as of 1.1.6 -using- works just fine).
//   2. You need to inform it about any Caterwaul extensions up-front (I'll explain how to do this).

// Extensions.
// Caterwaul can be extended with custom macros, and in order to precompile something that uses these extensions you'll have to inform Waul about them. You can do this with the --extension flag,
// like this:

// | $ waul --extension caterwaul.custom.js foo.waul

// This will result in Waul loading in the custom extensions before customizing the Caterwaul instance that is used inside foo.waul. Waul comes with the standard library built-in, but you can
// disable it:

// | $ waul --no-std foo.waul                              # just use Caterwaul core

// You can compile multiple files at once using multiple arguments. If you do this, each will be compiled to its own .js file.

// Dependencies.
// This program depends on Caterwaul, which is baked in minified here. It includes the 'ui' library even though Waul itself doesn't use it. The reason is that Waul scripts are allowed to, so Waul
// needs to be prepared to precompile things that depend on it.

(function(a){return a(a)})(function(f,E,s){(function(au){return au(au)})(function(au){var ax=function(){var ay=function(){return ay.init.apply(ay,arguments)};return ay},aw=typeof caterwaul==="undefined"?s:caterwaul,av=ax();av.deglobalize=function(){caterwaul=aw;return av};av.core_initializer=au;av.modules=[];av.module=function(az,ay,aA){if(arguments.length===1){return av[az+"_initializer"]}if(!(az+"_initializer" in av)){av.modules.push(az)}aA||(aA=ay,ay=null);(av[az+"_initializer"]=ay?av(ay)(aA):aA)(av);return av};return caterwaul=av});var am=function(au){return au.split(/\s+/)},H=function(au,av){return av&&av.call(au,au)||au},r=function(au){throw new Error(au)},c=E||(function(){for(var au=[],aw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$_",av=21,ax;av>=0;--av){au.push(aw.charAt(Math.random()*64>>>0))}return au.join("")})(),ae=(function(au){return function(av){return[av||"",(++au).toString(36),c].join("_")}})(0),ad=function(au){return au.substr(au.length-22)===c},j=function(av,au){return function(){return av.apply(au,arguments)}},V=function(ay,av){for(var aw=0,ax=[],au=av.length;aw<au;++aw){ax.push(ay(av[aw],aw))}return ax},B=function(av,au){return V(function(aw){return aw instanceof Array?B(av,aw):av(aw)})},al=function(ax){for(var aw=0,av=am(ax),ay={},au=av.length;aw<au;++aw){ay[av[aw]]=true}return w(ay)},aj=(function(av){for(var au in av){if(av.hasOwnProperty(au)){return true}}})({toString:true})?function(ay){for(var ax=1,au=arguments.length,aw;ax<au;++ax){if(aw=arguments[ax]){for(var av in aw){if(g(aw,av)){ay[av]=aw[av]}}}}return ay}:function(ay){for(var ax=1,au=arguments.length,aw;ax<au;++ax){if(aw=arguments[ax]){for(var av in aw){if(g(aw,av)){ay[av]=aw[av]}}if(aw.toString&&!/\[native code\]/.test(aw.toString.toString())){ay.toString=aw.toString}}}return ay},ai=ae("hash"),w=function(aw){var au=0;for(var av in aw){n.call(aw,av)&&(au=av.length>au?av.length:au)}aw[ai]=au;return aw},g=function(av,au){return au!=null&&!(au.length>av[ai])&&n.call(av,au)},n=Object.prototype.hasOwnProperty,at=aj(caterwaul,{merge:aj,map:V,rmap:B,gensym:ae,is_gensym:ad}),ar=al(". new ++ -- u++ u-- u+ u- typeof u~ u! ! * / % + - << >> >>> < > <= >= instanceof in == != === !== & ^ | && || ? = += -= *= /= %= &= |= ^= <<= >>= >>>= : , return throw case var const break continue void else u; ;"),aa=function(ax){for(var aw=0,av=[false];aw<8;++aw){av.push.apply(av,av)}for(var aw=0,au=ax.length;aw<au;++aw){av[ax.charCodeAt(aw)]=true}return av},ap=aa(".0123456789"),ac=aa("0123456789"),D=aa("0123456789abcdefABCDEFx"),S=aa("eE"),l=aa(" \n\r\t"),x=aa("()[]{}?:"),u=aa("([{?:"),C=aa("+-*/%&|^!~=<>?:;.,"),Q=aa("\n\r"),m=aa("gims"),W=aa("'\"/"),q="/".charCodeAt(0),ab="0".charCodeAt(0),ao=al("++ --"),af=aa("$_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"),Z="*".charCodeAt(0),p="\\".charCodeAt(0),ah="x".charCodeAt(0),U=".".charCodeAt(0),O="#".charCodeAt(0),R=V(al,["function","( [ . [] ()","new delete","u++ u-- ++ -- typeof u~ u! u+ u-","* / %","+ -","<< >> >>>","< > <= >= instanceof in","== != === !==","&","^","|","&&","||","case","? = += -= *= /= %= &= |= ^= <<= >>= >>>=",":",",","return throw break continue void","var const","if else try catch finally for switch with while do",";"]),N=al("= += -= *= /= %= &= ^= |= <<= >>= >>>= ~ ! new typeof u+ u- -- ++ u-- u++ ? if else function try catch finally for switch case with while do"),K=(function(aw){for(var ay={},ax=0,au=aw.length;ax<au;++ax){for(var av in aw[ax]){g(aw[ax],av)&&(ay[av]=ax)}}return w(ay)})(R),A=(function(aw){for(var ay=[],az=0,au=aw.length,ax=null;ax=aw[az],ay[az]=true,az<au;++az){for(var av in ax){if(g(ax,av)&&(ay[az]=ay[az]&&!g(N,av))){break}}}return ay})(R),G=al("[] . () * / % + - << >> >>> < > <= >= instanceof in == != === !== & ^ | && || = += -= *= /= %= &= |= ^= <<= >>= >>>= , : ;"),ag=w({"function":2,"if":1,"do":1,"catch":1,"try":1,"for":1,"while":1,"with":1,"switch":1}),Y=w({"if":"else","do":"while","catch":"finally","try":"catch"}),I=al("[] ()"),an=al("return throw break continue else"),J=al("u+ u- u! u~ u++ u-- new typeof finally case var const void delete"),i=al("; {"),ak=al("i;"),P=al("++ --"),t=w({"(":")","[":"]","{":"}","?":":"}),L=al("[ ("),X=al("?"),e=al("function if for while catch void delete new typeof in instanceof"),F=al("function"),z=at.syntax_common={_replace:function(au){return(au.l=this.l)&&(this.l.r=au),(au.r=this.r)&&(this.r.l=au),this},_append_to:function(au){return au&&au._append(this),this},_reparent:function(au){return this.p&&this.p[0]===this&&(this.p[0]=au),this},_fold_l:function(au){return this._append(this.l&&this.l._unlink(this)||a)},_append:function(au){return(this[this.length++]=au)&&(au.p=this),this},_fold_r:function(au){return this._append(this.r&&this.r._unlink(this)||a)},_sibling:function(au){return au.p=this.p,(this.r=au).l=this},_fold_lr:function(){return this._fold_l()._fold_r()},_fold_rr:function(){return this._fold_r()._fold_r()},_wrap:function(au){return au.p=this._replace(au).p,this._reparent(au),delete this.l,delete this.r,this._append_to(au)},_unlink:function(au){return this.l&&(this.l.r=this.r),this.r&&(this.r.l=this.l),delete this.l,delete this.r,this._reparent(au)},pop:function(){return --this.length,this},push:function(au){return this[this.length++]=au||a,this},id:function(){var au=ae("id");return(this.id=function(){return au})()},is_caterwaul_syntax:true,each:function(aw){for(var av=0,au=this.length;av<au;++av){aw(this[av],av)}return this},map:function(aw){for(var ax=new this.constructor(this),av=0,au=this.length;av<au;++av){ax.push(aw(this[av],av)||this[av])}return ax},reach:function(au){au(this);this.each(function(av){av.reach(au)});return this},rmap:function(av){var au=av(this);return !au||au===this?this.map(function(aw){return aw.rmap(av)}):au===true?this:au.rmap===s?new this.constructor(au):au},peach:function(au){this.each(function(av){av.peach(au)});au(this);return this},pmap:function(av){var au=this.map(function(aw){return aw.pmap(av)});return av(au)},clone:function(){return this.rmap(function(){return false})},collect:function(av){var au=[];this.reach(function(aw){av(aw)&&au.push(aw)});return au},replace:function(au){var av;return n.call(au,this.data)&&(av=au[this.data])?av.constructor===String?H(this.map(function(aw){return aw.replace(au)}),function(){this.data=av}):av:this.map(function(aw){return aw.replace(au)})},repopulated_with:function(au){return new this.constructor(this.data,au)},with_data:function(au){return new this.constructor(au,Array.prototype.slice.call(this))},change:function(av,au){return H(new this.constructor(this.data,Array.prototype.slice.call(this)),function(aw){aw[av]=au})},compose_single:function(au,av){return this.change(au,av(this[au]))},slice:function(av,au){return new this.constructor(this.data,Array.prototype.slice.call(this,av,au))},traverse:function(au){au({entering:this});au({exiting:this.each(function(av){av.traverse(au)})});return this},flatten:function(au){au=au||this.data;return au!==this.data?this.as(au):!(g(G,au)&&this.length)?this:g(N,au)?H(new this.constructor(au),j(function(aw){for(var av=this;av&&av.data===au;av=av[1]){aw.push(av[0])}aw.push(av)},this)):H(new this.constructor(au),j(function(ax){for(var av=this,aw=[];av.data===au;av=av[0]){av[1]&&aw.push(av[1])}aw.push(av);for(av=aw.length-1;av>=0;--av){ax.push(aw[av])}},this))},unflatten:function(){var av=this,au=g(N,this.data);return this.length<=2?this:H(new this.constructor(this.data),function(ay){if(au){for(var ax=0,aw=av.length-1;ax<aw;++ax){ay=ay.push(av[ax]).push(ax<aw-2?new av.constructor(av.data):av[ax])[1]}}else{for(var ax=av.length-1;ax>=1;--ax){ay=ay.push(ax>1?new av.constructor(av.data):av[0]).push(av[ax])[0]}}})},as:function(au){return this.data===au?this:new this.constructor(au).push(this)},bindings:function(av){var au=av||{};this.reach(function(aw){if(aw.binds_a_value){au[aw.data]=aw.value}});return au},expressions:function(av){var au=av||{};this.reach(function(aw){if(aw.binds_an_expression){au[aw.data]=aw.e}});return au},contains:function(ax){var au=ax(this);if(au){return au}for(var aw=0,av=this.length;aw<av;++aw){if(au=this[aw].contains(ax)){return au}}},match:function(aw,ax){aw=aw.constructor===String?at.parse(aw):aw;ax||(ax={_:aw});if(this.is_wildcard()){return ax[this.data]=aw,ax}else{if(this.length===aw.length&&this.data===aw.data){for(var av=0,au=this.length;av<au;++av){if(!this[av].match(aw[av],ax)){return null}}return ax}}},toString:function(){var au=[""];this.serialize(au);return au.join("")},structure:function(){if(this.length){return"("+['"'+this.data+'"'].concat(V(function(au){return au.structure()},this)).join(" ")+")"}else{return this.data}}};at.syntax_subclass=function(aw){var av=Array.prototype.slice.call(arguments,1),au=function(){return aw.apply(this,arguments)};aj.apply(this,[au.prototype,z].concat(av));au.prototype.constructor=au;return au};var b=at.parse_hex=function(ax){for(var au=0,aw=0,av=ax.length,ay;aw<av;++aw){au*=16,au+=(ay=ax.charCodeAt(aw))<=58?ay-48:(ay&95)-55}return au},aq=at.parse_octal=function(ax){for(var au=0,aw=0,av=ax.length;aw<av;++aw){au*=8,au+=ax.charCodeAt(aw)-48}return au},d=at.unescape_string=function(ay){for(var ax=0,az,av=ay.length,au=[],aw=false;ax<av;++ax){if(aw){aw=false,au.push((az=ay.charAt(ax))==="\\"?"\\":az==="n"?"\n":az==="r"?"\r":az==="b"?"\b":az==="f"?"\f":az==="0"?"\u0000":az==="t"?"\t":az==="v"?"\v":az==='"'||az==="'"?az:az==="x"?String.fromCharCode(b(ay.substring(ax,++ax+1))):az==="u"?String.fromCharCode(b(ay.substring(ax,(ax+=3)+1))):String.fromCharCode(aq(ay.substring(ax,(ax+=2)+1))))}else{if((az=ay.charAt(ax))==="\\"){aw=true}else{au.push(az)}}}return au.join("")};at.javascript_tree_type_methods={is_string:function(){return/['"]/.test(this.data.charAt(0))},as_escaped_string:function(){return this.data.substr(1,this.data.length-2)},is_number:function(){return/^-?(0x|\d|\.\d+)/.test(this.data)},as_number:function(){return Number(this.data)},is_boolean:function(){return this.data==="true"||this.data==="false"},as_boolean:function(){return this.data==="true"},is_regexp:function(){return/^\/./.test(this.data)},as_escaped_regexp:function(){return this.data.substring(1,this.data.lastIndexOf("/"))},is_array:function(){return this.data==="["},as_unescaped_string:function(){return d(this.as_escaped_string())},is_wildcard:function(){return this.data.charCodeAt(0)===95},is_identifier:function(){return this.length===0&&/^[A-Za-z_$]\w*$/.test(this.data)&&!this.is_boolean()&&!this.is_null_or_undefined()&&!g(ar,this.data)},has_grouped_block:function(){return g(ag,this.data)},is_block:function(){return g(i,this.data)},is_blockless_keyword:function(){return g(an,this.data)},is_null_or_undefined:function(){return this.data==="null"||this.data==="undefined"},is_constant:function(){return this.is_number()||this.is_string()||this.is_boolean()||this.is_regexp()||this.is_null_or_undefined()},left_is_lvalue:function(){return/=$/.test(this.data)||/\+\+$/.test(this.data)||/--$/.test(this.data)},is_empty:function(){return !this.length},has_parameter_list:function(){return this.data==="function"||this.data==="catch"},has_lvalue_list:function(){return this.data==="var"||this.data==="const"},is_dereference:function(){return this.data==="."||this.data==="[]"},is_invocation:function(){return this.data==="()"},is_contextualized_invocation:function(){return this.is_invocation()&&this[0].is_dereference()},is_invisible:function(){return g(ak,this.data)},is_binary_operator:function(){return g(G,this.data)},is_prefix_unary_operator:function(){return g(J,this.data)},is_postfix_unary_operator:function(){return g(P,this.data)},is_unary_operator:function(){return this.is_prefix_unary_operator()||this.is_postfix_unary_operator()},accepts:function(au){return g(Y,this.data)&&Y[this.data]===(au.data||au)}};at.javascript_tree_serialization_methods={ends_with_block:function(){var au=this[ag[this.data]];return this.data==="{"||g(ag,this.data)&&(this.data!=="function"||this.length===3)&&au&&au.ends_with_block()},serialize:function(ax){var av=this.length,ay=this.data,au=";\n",aw=function(az){if(af[ax[ax.length-1].charCodeAt(0)]===af[az.charCodeAt(0)]){ax.push(" ",az)}else{ax.push(az)}};switch(av){case 0:if(g(an,ay)){return aw(ay.replace(/^u/,""))}else{if(g(t,ay)){return aw(ay),aw(t[ay])}else{return aw(ay)}}case 1:if(g(J,ay)||g(an,ay)){return aw(ay.replace(/^u/,"")),this[0].serialize(ax)}else{if(g(t,ay)){return aw(ay),this[0].serialize(ax),aw(t[ay])}else{if(g(G,ay)){return aw("/* unary "+ay+" node */"),this[0].serialize(ax)}else{return this[0].serialize(ax),aw(ay)}}}case 2:if(g(I,ay)){return this[0].serialize(ax),aw(ay.charAt(0)),this[1].serialize(ax),aw(ay.charAt(1))}else{if(g(ag,ay)){return aw(ay),this[0].serialize(ax),this[1].serialize(ax)}else{if(g(ak,ay)){return this[0].serialize(ax),this[1].serialize(ax)}else{if(ay===";"){return this[0].serialize(ax),aw(au),this[1].serialize(ax)}else{return this[0].serialize(ax),aw(ay),this[1].serialize(ax)}}}}default:if(g(X,ay)){return this[0].serialize(ax),aw(ay),this[1].serialize(ax),aw(":"),this[2].serialize(ax)}else{if(g(ag,ay)){return this.accepts(this[2])&&!this[1].ends_with_block()?(aw(ay),this[0].serialize(ax),this[1].serialize(ax),aw(au),this[2].serialize(ax)):(aw(ay),this[0].serialize(ax),this[1].serialize(ax),this[2].serialize(ax))}else{return this.unflatten().serialize(ax)}}}}};at.ref_common=aj({},at.javascript_tree_type_methods,at.javascript_tree_serialization_methods,{replace:function(au){var av;return n.call(au,this.data)&&(av=au[this.data])?av.constructor===String?H(new this.constructor(this.value),function(){this.data=av}):av:this},length:0});at.ref=at.syntax_subclass(function(av,au){if(av instanceof this.constructor){this.value=av.value,this.data=av.data}else{this.value=av,this.data=ae(au&&au.constructor===String?au:"ref")}},at.ref_common,{binds_a_value:true});at.expression_ref=at.syntax_subclass(function(av,au){if(av instanceof this.constructor){this.e=av.e,this.data=av.data}else{this.e=av,this.data=ae(au&&au.constructor===String?au:"e")}},at.ref_common,{binds_an_expression:true});at.opaque_tree=at.syntax_subclass(function(au){this.data=au instanceof this.constructor?au.data:au.toString()},{serialize:function(au){return au.push(this.data),au},parse:function(){return at.parse(this.data)}});at.syntax=at.syntax_subclass(function(az){if(az instanceof this.constructor){this.data=az.data,this.length=0}else{this.data=az&&az.toString();this.length=0;for(var ax=1,au=arguments.length,aw;aw=arguments[ax],ax<au;++ax){for(var av=0,aB=aw.length,ay,aA;aw instanceof Array?(ay=aw[av],av<aB):(ay=aw,!av);++av){this._append((aA=ay.constructor)===String||aA===Number||aA===Boolean?new this.constructor(ay):ay)}}}},at.javascript_tree_type_methods,at.javascript_tree_serialization_methods);var a=at.empty=new at.syntax("");at.parse=function(au){if(au.constructor===at.syntax){return au}var aP=au.toString(),az=0,a1=0,aM=true,aL=false,a3=false,a2=false,aQ=0,aN="",aY=0,aV=aP.length,aG=function(a5){return aP.charCodeAt(a5)},aE=[],aU=null,aC=null,aA=null,av=V(function(){return[]},R),aB=[],aO=[a],aW=function(a5){return aO.push(a5),a5},aR=function(a5){return aC?aC._sibling(aC=a5):(aC=a5._append_to(aA)),aW(a5)},aw=this.syntax,aD=[];if(aV===0){return a}while((az=aY)<aV){while(l[a1=aG(aY)]&&aY<aV){az=++aY}aL=a2=a3=aN=false;if(x[a1]){aN=!!++aY;aM=u[a1]}else{if(a1===q&&aG(aY+1)===Z&&(aY+=2)){while(++aY<aV&&aG(aY)!==q||aG(aY-1)!==Z){}aN=!++aY}else{if(a1===q&&aG(aY+1)===q){while(++aY<aV&&!Q[aG(aY)]){}aN=false}else{if(a1===O){while(++aY<aV&&!Q[aG(aY)]){}aN=false}else{if(W[a1]&&(aQ=a1)&&aM&&!(aM=!(aN=aP.charAt(aY)))){while(++aY<aV&&(a1=aG(aY))!==aQ||aL){aL=!aL&&a1===p}while(++aY<aV&&m[aG(aY)]){}aN=true}else{if(a1===ab&&D[aG(aY+1)]){while(++aY<aV&&D[aG(aY)]){}aM=!(aN=true)}else{if(ap[a1]&&(a1!==U||ac[aG(aY+1)])){while(++aY<aV&&(ac[a1=aG(aY)]||(a3^(a3|=a1===U))||(a2^(a2|=S[a1]&&++aY)))){}while(aY<aV&&ac[aG(aY)]){++aY}aM=!(aN=true)}else{if(C[a1]&&(aN=aM?"u":"",aM=true)){while(aY<aV&&C[aG(aY)]&&g(ar,aN+aP.charAt(aY))){aN+=aP.charAt(aY++)}aM=!g(ao,aN)}else{while(++aY<aV&&(af[a1=aG(aY)]||a1>127)){}aM=g(ar,aN=aP.substring(az,aY))}}}}}}}}if(aY===az){throw new Error('Caterwaul lex error at "'+aP.substr(az,40)+'" with leading context "'+aP.substr(az-40,40)+'" (probably a Caterwaul bug)')}if(aN===false){continue}aN=aN===true?aP.substring(az,aY):aN==="u;"?";":aN;aN===aU?(aE.pop(),aU=aE[aE.length-1],aC=aC?aC.p:aA,aA=null):(g(t,aN)?(aE.push(aU=t[aN]),aA=aR(aW(new aw(aN))),aC=null):aR(aW(new aw(aN))),g(K,aN)&&av[K[aN]].push(aC||aA));aM|=aN===")"&&aC.l&&g(ag,aC.l.data)}for(var aY=0,aV=av.length,aK,a4;a4=av[aY],aK=A[aY],aY<aV;++aY){for(var aX=aK?0:a4.length-1,aJ=a4.length,aZ=aK?1:-1,aH,a0,aI;aK?aX<aJ:aX>=0;aX+=aZ){if(g(G,a0=(aH=a4[aX]).data)){aH._fold_lr()}else{if(g(L,a0)&&aH.l&&!((aI=aH.l.l)&&g(ag,aI.data))&&(aH.l.data==="."||(aH.l.data==="function"&&aH.l.length===2)||!(g(ar,aH.l.data)||g(e,aH.l.data)))){aB.push(aH.l._wrap(aW(new aw(a0+t[a0]))).p._fold_r())}else{if(g(P,a0)){aH._fold_l()}else{if(g(J,a0)){aH._fold_r()}else{if(g(X,a0)){aH._fold_lr(),aD.push(aH)}else{if(g(ag,a0)&&aH.r&&aH.r.data!==":"){for(var aS=0,aF=ag[a0];aS<aF&&aH.r&&!g(i,aH.r.data);++aS){aH._fold_r()}aH.r&&(aH.r.data===";"?aH.push(a):aH._fold_r());if(g(Y,a0)&&Y[a0]===(aH.r&&aH.r.r&&aH.r.r.data)){aH._fold_r().pop()._fold_r()}else{if(g(Y,a0)&&Y[a0]===(aH.r&&aH.r.data)){aH._fold_r()}}}else{if(g(an,a0)){aH.r&&aH.r.data!==";"&&aH._fold_r()}}}}}}}}}for(var aY=aO.length-1,a4;aY>=0;--aY){(a4=aO[aY]).r&&a4._wrap(aW(new aw("i;"))).p._fold_r()}for(var aY=0,aV=aB.length,a4,ax;aY<aV;++aY){(ax=(a4=aB[aY])[1]=a4[1][0]||a)&&(ax.p=a4)}for(var aY=0,aV=aD.length,a4,aT,ay;aY<aV;++aY){aT=(a4=aD[aY]).length,ay=a4[0],a4[0]=a4[aT-2],a4[1]=ay,a4[2]=a4[aT-1],a4.length=3}while(aC.p){aC=aC.p}for(var aY=aO.length-1,a4;aY>=0;--aY){delete (a4=aO[aY]).p,delete a4.l,delete a4.r}return aC};var o=at.parse("var _bindings; return(_expression)"),y=at.parse("_variable = _base._variable"),h=at.parse("undefined = void(0)"),k=at.parse("(function (_bindings) {return(_body)}).call(this, _expressions)");at.compile=function(aF,az,aE){aE=aj({gensym_renaming:true},aE);aF=at.late_bound_tree(aF);var aw=aj({},this._environment||{},az||{},aF.bindings()),aB=[h],aD=ae("base");for(var ay in aw){if(n.call(aw,ay)&&ay!=="this"){aB.push(y.replace({_variable:ay,_base:aD}))}}var aC=new this.syntax(",",aB).unflatten(),au=o.replace({_bindings:aC,_expression:aF});if(aE.gensym_renaming){var ax=this.gensym_rename_table(au);for(var ay in aw){n.call(aw,ay)&&(aw[ax[ay]||ay]=aw[ay])}au=au.replace(ax);aD=ax[aD]}var av=au.toString();try{return(new Function(aD,av)).call(aw["this"],aw)}catch(aA){throw new Error((aA.message||aA)+" while compiling "+av)}};at.late_bound_tree=function(av,au){var az=aj({},au||{},av.expressions()),ay=new at.syntax(","),ax=new at.syntax(",");for(var aw in az){if(n.call(az,aw)){ay.push(new at.syntax(aw)),ax.push(az[aw])}}return ay.length?k.replace({_bindings:ay.unflatten(),_expressions:ax.unflatten(),_body:av}):av};at.gensym_rename_table=function(aC){var aB={},az=[];aC.reach(function(aD){var aE=aD.data;if(ad(aE)){aB[aE]||az.push(aE)}aB[aE]=aE.replace(/^(.*)_[a-z0-9]+_.{22}$/,"$1")||"anon"});var au={},aA=function(aD){if(!(aD in aB)){return aD}var aE=au[aD]||0;while(aB[aD+(++aE).toString(36)]){}return aD+(au[aD]=aE).toString(36)};for(var av={},ax=0,aw=az.length,ay;ax<aw;++ax){av[ay=az[ax]]||(aB[av[ay]=aA(aB[ay])]=true)}return av};var T=function(av){for(var aw=av.split(/\s+/),ax=1,au=aw.length,ay=at[aw[0]]();ax<au;++ax){ay=at[aw[ax]](ay)}return ay};at.init=function(au){au||(au=function(av){return true});return au.constructor===Function?H((function(){var av=function(ay,aw,ax){return typeof ay==="function"||ay.constructor===String?at.compile(av.call(av,at.parse(ay)),aw,ax):ay.rmap(function(az){return au.call(av,az,aw,ax)})};return av})(),function(){this.global=at,this.macroexpander=au}):T(au)};at.initializer=f;at.clone=function(){return H(f(f,c).deglobalize(),function(){for(var au in at){this[au]||(this[au]=at[au])}})};var v=at.parse("(function (f) {return f(f)})(_x)"),M=at.parse("module(_name, _f)");at.replicator=function(ax){if(ax&&ax.minimal_core_only){return v.replace({_x:new this.opaque_tree(this.core_initializer)})}if(ax&&ax.core_only){return v.replace({_x:new this.opaque_tree(this.initializer)})}for(var ay=0,aw=this.modules,az=[],av=aw.length;ay<av;++ay){az.push(M.replace({_name:"'"+aw[ay]+"'",_f:new this.opaque_tree(this.module(aw[ay]))}))}for(var ay=0,av=az.length,au=new this.syntax(".",v.replace({_x:new this.opaque_tree(this.initializer)}));ay<av;++ay){au.push(az[ay])}return au.unflatten()};return caterwaul=at});
caterwaul.module("std.macro",function(c){var b=function(e){var d=function(f){if(f.constructor===Array){for(var h=0,g=f.length,j=[];h<g;++h){j.push(d(f[h]))}return function(k){for(var l=j.length-1,m;l>=0;--l){if(m=j[l].call(this,k)){return m}}}}else{return f.constructor===String?d(c.parse(f)):f.constructor===c.syntax?e.call(this,f):f}};return d};c.pattern=b(function(d){return function(e){return d.match(e)}});c.expander=b(function(d){return function(e){return d.replace(e)}});c.alternatives=b(function(d){throw new Error("must use replacer functions with caterwaul.alternatives()")});c.reexpander=function(f){var d=c.expander(f);return function(e){var g=d.call(this,e);return g&&this(g)}};var a=function(d){return function(f,h){var g=c.pattern(f),e=d(h);return function(i){var j=g.call(this,i);return j&&e.call(this,j)}}};c.replacer=a(c.expander);c.rereplacer=a(c.reexpander);c.macroexpand=function(d){return c(c.alternatives(Array.prototype.slice.call(arguments,1)))(d)}});caterwaul.module("std.anon",function(a){a.anonymizer=function(){for(var d={},c=0,b=arguments.length;c<b;++c){d[arguments[c]]=a.gensym(arguments[c])}return function(e){return a.parse(e).replace(d)}}});caterwaul.module("std.js",function(a){a.js=function(c){var f=function(I){var Q=I.data,F=Q.charAt(0),K=a.syntax;if(F!=="'"&&F!=='"'||!/#\{[^\}]+\}/.test(Q)){return false}for(var J=[],R=[],M=1,L=Q.length-1,P=0,N=false,G=1,O;M<L;++M){if(P){if((O=Q.charAt(M))==="}"){--P||(J.push(Q.substring(G,M)),R.push(true))&&(G=M+1),N=false}else{P+=O==="{"}}else{if((O=Q.charAt(M))==="#"){N=true}else{if(O==="{"&&N){J.push(Q.substring(G,M-1)),R.push(false),G=M+1,++P}else{N=false}}}}J.push(Q.substring(G,L)),R.push(false);for(var H=new RegExp("\\\\"+F,"g"),M=0,L=J.length;M<L;++M){J[M]=R[M]?this(a.parse(J[M].replace(H,F)).as("(")):new K(F+J[M]+F)}return new K("+",J).unflatten().as("(")};var B=a.parse("var _x = _y"),E=a.parse("_x = _y"),y=a.parse("result"),D=a.parse("function (_formals) {_befores; var result = _result; _afters; return result}"),z=a.parse("function (_formals) {_befores; return _result}"),g=a.parse("_f = _x"),A=function(F){return F.is_empty()&&F.data==="result"},p=a.rereplacer("_f(_xs) = _y",function(O){for(var P=[],T=[],U=[],F=O._xs.flatten(","),N=0,L=F.length;N<L;++N){(U.length||F[N].contains(A)?U:T.length||F[N].length?T:P).push(F[N])}for(var K=[T,U],N=0,L=K.length;N<L;++N){for(var J=K[N],M=0,R=J.length,I;M<R;++M){J[M]=(I=E.match(J[M]))&&I._x.is_empty()?B.replace(I):J[M].as("(")}}var Q=P.length?new a.syntax(",",P).unflatten():a.empty,H=T.length?new a.syntax(";",T).unflatten():a.empty,G=U.length?new a.syntax(";",U).unflatten():a.empty,S=g.replace({_f:O._f,_x:U.length?D:z});return S.replace({_formals:Q,_befores:H,_afters:G,_result:O._y})});var q=function(G){var I=G.data,H,F;if((I==="/"||I==="|")&&(H=G[0]).data===I&&H[1]&&H[1].data==="u-"&&(F=H[1][0])){return new a.syntax("()",F,this(G[0][0]).flatten(I).push(this(G[1])).with_data(",").unflatten())}};var x=function(I){var K=I.data,J,H;if((K==="/"||K==="|")&&(J=I[0]).data===K&&J[1]&&J[1].data==="u~"&&(H=J[1][0])){var G=[].slice.call(this(I[0][0]).flatten(K)),F=G.shift();return new a.syntax("()",new a.syntax(".",new a.syntax("(",F),H),new a.syntax(",",G,this(I[1])).unflatten())}};var l=a.parse("_f(_x)"),h=a.rereplacer("_x /!_f",function(F){return l.replace({_f:F._f,_x:this(F._x).flatten("/").with_data(",").unflatten()})});var j=a.pattern("_literal._modifier"),w=function(G,H,F){var I=G.literal_modifiers[H];return I.hasOwnProperty(F)&&I[F]},n=function(H){var G=j.call(this,H),F,I;if(G&&(F=G._literal)&&(I=F.is_identifier()?w(this,"identifier",G._modifier.data):F.is_array()?w(this,"array",G._modifier.data):F.is_regexp()?w(this,"regexp",G._modifier.data):F.is_number()?w(this,"number",G._modifier.data):F.is_string()?w(this,"string",G._modifier.data):null)){return I.call(this,F)}};var s=a.pattern("_modifier[_expression]"),i=a.pattern("_expression /_modifier"),u=a.pattern("_expression -_modifier"),C=a.pattern("_modifier in _expression"),r=a.pattern("_expression |_modifier"),t=a.pattern("_expression, _modifier"),o=a.pattern("_modifier._parameters"),k=a.pattern("_modifier[_parameters]"),v=a.pattern("_expression <_modifier> _parameters"),e=a.pattern("_expression -_modifier- _parameters"),b=function(K){var F,G=v.call(this,K)||e.call(this,K);if(G&&this.parameterized_modifiers.hasOwnProperty(F=G._modifier.data)){var J=this.parameterized_modifiers[F].call(this,G);if(J){return J}}var I=s.call(this,K)||i.call(this,K)||u.call(this,K)||C.call(this,K)||r.call(this,K)||t.call(this,K);if(I){var H=o.call(this,I._modifier)||k.call(this,I._modifier);if(H){I._modifier=H._modifier;I._parameters=H._parameters;return this.parameterized_modifiers.hasOwnProperty(F=I._modifier.data)&&this.parameterized_modifiers[F].call(this,I)}else{return this.modifiers.hasOwnProperty(F=I._modifier.data)&&this.modifiers[F].call(this,I)}}};var d=function(F){return f.call(this,F)||n.call(this,F)||F.length&&(b.call(this,F)||p.call(this,F)||q.call(this,F)||x.call(this,F)||h.call(this,F))},m=c?a(function(F){return c.call(this,F)||d.call(this,F)}):a(d);m.modifiers={};m.parameterized_modifiers={};m.literal_modifiers={regexp:{},array:{},string:{},number:{},identifier:{}};return m}});caterwaul.module("std.js-literals",function(a){a.js_literals=function(c){var b=a.parse("function (_) {return _body}");(function(d){d.x=a.reexpander(function(f){return f.with_data(f.data.replace(/\s+/g,""))});var e=a.parse("_regexp.exec(_)");d.qf=function(f){return b.replace({_body:e.replace({_regexp:f})})}})(c.literal_modifiers.regexp);(function(d){d.qw=a.reexpander(function(k){for(var m=new a.syntax("["),e=new a.syntax(","),g=k.data.charAt(0),j=k.as_escaped_string().split(/\s+/),h=0,f=j.length;h<f;++h){e.push(new a.syntax(g+j[h]+g))}return m.push(e.unflatten())});d.qh=a.reexpander(function(k){for(var m=new a.syntax("{"),e=new a.syntax(","),g=k.data.charAt(0),j=k.as_escaped_string().split(/\s+/),h=0,f=j.length;h<f;h+=2){e.push(new a.syntax(":",new a.syntax(g+j[h]+g),new a.syntax(g+j[h+1]+g)))}return m.push(e.unflatten())});d.qr=a.reexpander(function(e){return e.with_data("/"+e.as_escaped_string().replace(/\//g,"\\/")+"/")});d.qs=function(e){return new a.ref(a.parse(e.as_unescaped_string()))};d.qf=a.reexpander(function(e){return b.replace({_body:a.parse(e.as_unescaped_string())})})})(c.literal_modifiers.string);return c}});caterwaul.module("std.words",function($){var scope_template=$.parse("(function () {var _variables; return (_expression)}).call(this)"),trivial_node_template=$.parse("new caterwaul.syntax(_data)"),nontrivial_node_template=$.parse("new caterwaul.syntax(_data, _xs)");$.words=function(caterwaul_function){$.merge(caterwaul_function.modifiers,$.words.modifiers);$.merge(caterwaul_function.parameterized_modifiers,$.words.parameterized_modifiers);return caterwaul_function};$.syntax_to_expression=function(tree){if(tree.length){for(var comma=new $.syntax(","),i=0,l=tree.length;i<l;++i){comma.push($.syntax_to_expression(tree[i]))}return nontrivial_node_template.replace({_data:'"'+tree.data.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"',_xs:comma.unflatten()})}else{return trivial_node_template.replace({_data:'"'+tree.data.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"'})}};$.words.modifiers={qs:function(match){return new $.expression_ref($.syntax_to_expression(match._expression),"qs")},qse:function(match){return new $.expression_ref($.syntax_to_expression(this(match._expression)),"qse")},reexpand:function(match){return this(this(match._expression))},noexpand:function(match){return match._expression},raise:$.reexpander("(function () {throw _expression}).call(this)"),eval:function(match){return new $.ref($.compile(this(match._expression)),"eval")},delay:$.reexpander("(function (t, f) {return (function () {return f.call(t)})})(this, (function () {return _expression}))"),lazy:$.reexpander("(function (t, f, v, vc) {return (function () {return vc ? v : (vc = true, v = f.call(t))})})(this, (function () {return _expression}))"),capture:function(match){for(var comma=new $.syntax(","),bindings=match._expression.flatten(","),i=0,l=bindings.length;i<l;++i){comma.push(this(bindings[i]).with_data(":"))}return new $.syntax("{",comma.unflatten())},wcapture:function(match){for(var e=this(match._expression),comma=new $.syntax(","),bindings=e.flatten(","),node,i=0,l=bindings.length;i<l;++i){(node=this(bindings[i]))[1]=node[0],comma.push(node.with_data(":"))}return scope_template.replace({_variables:e,_expression:new $.syntax("{",comma.unflatten())})}};$.words.parameterized_modifiers={given:$.reexpander("(function (_parameters) {return _expression})"),bgiven:$.reexpander("(function (t, f) {return (function () {return f.apply(t, arguments)})})(this, (function (_parameters) {return _expression}))"),rescue:$.reexpander("(function () {try {return (_expression)} catch (e) {return (_parameters)}}).call(this)"),se:$.reexpander("(function (it) {return (_parameters), it}).call(this, (_expression))"),re:$.reexpander("(function (it) {return (_parameters)}).call(this, (_expression))"),where:$.reexpander("(function () {var _parameters; return (_expression)}).call(this)"),using:$.reexpander(function(match){var m=this(match._parameters),o=$.compile(m),comma=new $.syntax(","),expression_ref=new $.expression_ref(m);for(var k in o){Object.prototype.hasOwnProperty.call(o,k)&&/^[_$a-zA-Z][_$0-9a-zA-Z]*$/.test(k)&&comma.push(new $.syntax("=",k,new $.syntax(".",expression_ref,k)))}return scope_template.replace({_variables:comma.unflatten(),_expression:match._expression})}),when:$.reexpander("((_parameters) && (_expression))"),and:$.reexpander("((_expression) && (_parameters))"),unless:$.reexpander("(! (_parameters) && (_expression))"),or:$.reexpander("((_expression) || (_parameters))")}});caterwaul.module("std.seq",function(a){(function(){var d=a.anonymizer("S"),e=function(g,f){return a.rereplacer(g.constructor===String?d(g):g,f.constructor===String?d(f):f)},b=(function(){var s=a.anonymizer("x","y","i","j","l","lj","r","o","k"),h=d("(function (_xs) {var _x, _x0, _xi, _xl, _xr; _body}).call(this, S[_s])"),K=function(N){return h.replace({_body:N})},f=function(N){return N.replace(/@/g,"Array.prototype.slice.call").replace(/#/g,"Object.prototype.hasOwnProperty.call").replace(/%%/g,".constructor")},i=function(N){return s(K(d(f(N))))},J=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length; _xi < _xl; ++_xi) _x = _xs[_xi], _xr.push((_f));               return _xr"),m=i("for (var                    _xi = 0, _xl = _xs.length; _xi < _xl; ++_xi) _x = _xs[_xi], (_f);                         return _xs"),E=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length; _xi < _xl; ++_xi) _x = _xs[_xi], _xr.push.apply(_xr, @((_f))); return _xr"),r=i("for (var _x = _xs, _xi = 0, _x0, _xl;              _x0 = (_init); ++_xi) _x = (_f);                                   return _x"),v=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0;     _xi < _xl; ++_xi) _x = _xs[_xi], (_f) && _xr.push(_x);        return _xr"),k=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0;     _xi < _xl; ++_xi) _x = _xs[_xi], (_f) || _xr.push(_x);        return _xr"),g=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0, _y; _xi < _xl; ++_xi) _x = _xs[_xi], (_y = (_f)) && _xr.push(_y); return _xr"),l=i("for (var _xr = new _xs%%(), _xi = 0, _xl = _xs.length, _x0; _xi < _xl; ++_xi) _x = _xs[_xi], (_x0 = (_init)) && _xr.push(_f); return _xr"),L=i("for (var _x0 = _xs[0], _xi = 1, _xl = _xs.length;            _xi < _xl; ++_xi) _x = _xs[_xi], _x0 = (_f); return _x0"),G=i("for (var _xl = _xs.length, _xi = _xl - 2, _x0 = _xs[_xl - 1]; _xi >= 0; --_xi) _x = _xs[_xi], _x0 = (_f); return _x0"),w=i("for (var _xr = [], _x = _xs, _xi = 0;                      _x !== null; ++_xi) _xr.push(_x), _x = (_f);   return _xr"),F=i("for (var _x0 = (_init), _xi = 0, _xl = _xs.length;      _xi < _xl; ++_xi) _x = _xs[_xi], _x0 = (_f);     return _x0"),D=i("for (var _xl = _xs.length - 1, _xi = _xl, _x0 = (_init); _xi >= 0; --_xi) _x = _xs[_xi], _x0 = (_f);     return _x0"),C=i("for (var _xr = [], _x = _xs, _xi = 0, _x0;          _x0 = (_init); ++_xi) _xr.push(_x), _x = (_f);       return _xr"),B=i("for (var _x = _xs[0], _xi = 0, _xl = _xs.length, x; _xi < _xl; ++_xi) {_x = _xs[_xi]; if (x = (_f)) return x} return false"),u=i("for (var _x = _xs[0], _xi = 0, _xl = _xs.length, x; _xi < _xl; ++_xi) {_x = _xs[_xi]; if (x = (_f)) return false} return true"),q=d("(S[_xs]).concat((S[_ys]))"),H=i("for (var _xr = (S[_ys]), pairs = [], i = 0, l = _xs.length; i < l; ++i) pairs.push([_xs[i], _xr[i]]); return pairs"),j=i("for (var _xr = (S[_ys]), pairs = [], i = 0, l = _xs.length, lj = _xr.length; i < l; ++i) for (var j = 0; j < lj; ++j) pairs.push([_xs[i], _xr[j]]);return pairs"),I=i("var _xr = new _xs%%();  for (var _x in _xs) if (#(_xs, _x)) _xr[_f] = _xs[_x]; return _xr"),n=i("                        for (var _x in _xs) if (#(_xs, _x)) _f;                return _xs"),A=i("var _xr = new _xs%%();    for (var _x in _xs) if (#(_xs, _x) &&      (_f))  _xr[_x] = _xs[_x]; return _xr"),p=i("var _xr = new _xs%%();    for (var _x in _xs) if (#(_xs, _x) &&    ! (_f))  _xr[_x] = _xs[_x]; return _xr"),z=i("var _xr = new _xs%%(), x; for (var _x in _xs) if (#(_xs, _x) && (x = (_f))) _xr[x]  = _xs[_x]; return _xr"),x=i("var _xr = new _xs%%();    for (var  k in _xs) if (#(_xs, k)) _x = _xs[k], _xr[k] = (_f); return _xr"),M=i("                          for (var  k in _xs) if (#(_xs, k)) _x = _xs[k], _f;            return _xs"),t=i("var _xr = new _xs%%();    for (var  k in _xs) if (#(_xs, k)) _x = _xs[k],        (_f) && (_xr[k] = _x); return _xr"),o=i("var _xr = new _xs%%();    for (var  k in _xs) if (#(_xs, k)) _x = _xs[k],        (_f) || (_xr[k] = _x); return _xr"),y=i("var _xr = new _xs%%(), x; for (var  k in _xs) if (#(_xs, k)) _x = _xs[k], x = (_f), x && (_xr[k] =  x); return _xr");return((function(){var ap=function(aq){return(function(){throw new Error(aq)}).call(this)},ac=function(at,ar,aq,av,au){return at?at.replace({_f:aq,_init:av}).replace(a.merge({_s:ar},au)):ap(("unsupported sequence operator or modifiers used on "+(aq)+""))},U=function(aq){return function(ar){return(function(){var av=ar._xs,ax=this,aw=function(ay){return function(az,aA){return ac(ay,av,az,null,aA)}},au=function(ay){return function(az,aB,aA){return ac(ay,av,az,aB,aA)}},at=function(ay,az){return function(aA){return am(aA,ax,aw(ay),au(az))}};return(Y(ar._thing,at(aq.normal,aq.inormal),at(aq.bang,aq.ibang),at(aq.tbang,aq.itbang)))}).call(this)}},af=U({normal:J,bang:m,tbang:E,itbang:r}),ai=U({normal:v,bang:k,tbang:g,itbang:l}),ad=U({normal:L,bang:G,tbang:w,inormal:F,ibang:D,itbang:C}),V=U({normal:I,bang:n}),ag=U({normal:A,bang:p,tbang:z}),W=U({normal:x,bang:M}),ae=U({normal:t,bang:o,tbang:y}),N=U({normal:B,bang:u}),T=d("[_x]"),Z=d("_var[_x]"),al=d("[_init][_x]"),ah=d("_var[_init][_x]"),P=d("+_x"),ak=d("~_x"),R={_x:"x",_x0:"x0",_xi:"xi",_xl:"xl",_xs:"xs",_xr:"xr"},aj=function(aq){return{_x:aq,_x0:(""+(aq)+"0"),_xi:(""+(aq)+"i"),_xl:(""+(aq)+"l"),_xs:(""+(aq)+"s"),_xr:(""+(aq)+"r")}},ao=d("(_f).call({_x0: _x0, _xi: _xi, _xl: _xl, _xs: _xs, _xr: _xr}, _x)"),X=function(aq){return ao.replace({_f:aq})},O=d("(function (_x, _x0, _xi, _xl, _xs, _xr) {return _f}).call(this, _x, _x0, _xi, _xl, _xs, _xr)"),S=function(ar,aq){return O.replace(ar).replace({_f:aq})},an=d("S[_x]"),ab=function(aq){return an.replace({_x:aq})},am=function(aq,ar,at,au){return(function(){var av=function(aB){return ar.call(ar,ab(aB))},az=function(aB,aC){return at(av(aB),aC)},ay=function(aC,aB,aD){return au(av(aC),aB,aD)},aA=function(aB,aC){return at(S(aC,aB),aC)},aw=function(aC,aB,aD){return au(S(aD,aC),aB,aD)},ax=null;return(((ax=ak.match(aq))?am(ax._x,ar,az,ay):(ax=P.match(aq))?am(ax._x,ar,aA,aw):(ax=ah.match(aq))?au(ax._x,ax._init,aj(ax._var)):(ax=al.match(aq))?au(ax._x,ax._init,R):(ax=Z.match(aq))?at(ax._x,aj(ax._var)):(ax=T.match(aq))?at(ax._x,R):at(X(aq),R)))}).call(this)},Q=d("~!_x"),aa=d("!_x"),Y=function(aq,at,ar,au){return(function(){var av=null;return(((av=Q.match(aq))?au(av._x):(av=aa.match(aq))?ar(av._x):at(aq)))}).call(this)};return([e("S[_x]","_x"),e("S[_xs + _ys]",q),e("S[_xs ^ _ys]",H),e("S[_xs - _ys]",j),e("S[(_x)]","(S[_x])"),e("S[_x[_y]]","S[_x][_y]"),e("S[_xs(_ys)]","S[_xs](_ys)"),e("S[[_x]]","[_x]"),e("S[_x, _y]","S[_x], S[_y]"),e("S[_xs._p]","S[_xs]._p"),e("S[~[_x]]","[S[_x]]"),e("S[~_xs(_ys)]","S[_xs](S[_ys])"),e("S[_x ? _y : _z]","(S[_x]) ? (S[_y]) : (S[_z])"),e("S[_x && _y]","(S[_x]) && (S[_y])"),e("S[_x || _y]","(S[_x]) || (S[_y])"),e("S[+_xs]","Array.prototype.slice.call((_xs))"),e("S[_xs %_thing]",ai),e("S[_xs *_thing]",af),e("S[_xs /_thing]",ad),e("S[_xs |_thing]",N),e("S[_xs %k*_thing]",V),e("S[_xs %v*_thing]",W),e("S[_xs %k%_thing]",ag),e("S[_xs %v%_thing]",ae)])}).call(this))}).call(this),c=(function(){var i=function(n){return j.replace(a.merge({_lower:"0",_step:"1"},n))},h=function(n){return k.replace(a.merge({_lower:"0",_step:"1"},n))},j=d("(function (i, u, s) {if ((u - i) * s <= 0) return [];for (var r = [], d = u - i; d > 0 ? i <  u : i >  u; i += s) r.push(i); return r})((_lower), (_upper), (_step))"),k=d("(function (i, u, s) {if ((u - i) * s <= 0) return [];for (var r = [], d = u - i; d > 0 ? i <= u : i >= u; i += s) r.push(i); return r})((_lower), (_upper), (_step))"),q=d("(function (o) {_body}).call(this, (S[_o]))"),m=function(n){return q.replace({_body:n})},g=function(n){return(function(){var r=m(d(n));return((function(s){return r.replace(s)}))}).call(this)},p=g("var ks = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ks.push(k); return ks"),o=g("var vs = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && vs.push(o[k]); return vs"),f=g("var ps = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ps.push([k, o[k]]); return ps"),l=g("for (var r = {}, i = 0, l = o.length, x; i < l; ++i) x = o[i], r[x[0]] = x[1]; return r");return([e("S[n[_upper]]",i),e("S[ni[_upper]]",h),e("S[_o /keys]",p),e("S[_o |object]",l),e("S[n[_lower, _upper]]",i),e("S[ni[_lower, _upper]]",h),e("S[_o /values]",o),e("S[_o -object]",l),e("S[n[_lower, _upper, _step]]",i),e("S[ni[_lower, _upper, _step]]",h),e("S[_o /pairs]",f),e("S[_o /object]",l)])}).call(this);return(a.seq=function(f){return(function(){var h=d("S[_x]"),g=a(a.alternatives(b.concat(c)));return((function(i){return(i.modifiers.seq=function(j){return(function(k){return(((k)&&(this(k))))}).call(this,(g.call(g,h.replace({_x:j._expression}))))}),i}).call(this,(f)))}).call(this)})}).call(this)});caterwaul.module("std",function(a){a.js_all=function(){return this("js js_literals words seq")}});
caterwaul.module("ui.jquery",function(a){(function(){var i="jQuery",f=a.anonymizer("J","TS","S","P","PS"),d=function(j){return j.replace(/_/g,"-")},h=function(k,j){return a.rereplacer(f(k),j.constructor===Function?(function(l){return j.call(this,l)}):f(j))},g=(function(){var j=f("P[_thing]");return((function(k){return j.replace({_thing:k})}))}).call(this),e=(function(){var l=f((""+(i)+"(TS[_element])")),m=f((""+(i)+'("<span>" + (_element) + "</span>")')),j=function(n){return l.replace(n)},k=function(n){return m.replace(n)};return([h("J[_element]",(function(n){return n._element.is_constant()||n._element.length?k(n):j(n)})),h("J[_element._class]","J[_element].addClass(S[_class])"),h("J[_element *_attr(_val)]","J[_element].attr(S[_attr], _val)"),h("J[_element *!_name(_val)]","J[_element].data(S[_name], _val)"),h("J[_element /_method(_args)]","J[_element]._method(_args)"),h("J[_element /!_event(_args)]","J[_element].bind(S[_event], _args)"),h("J[_element %_function]","_function(J[_element])"),h("J[_element(_children)]","J[_element].append(J[_children])"),h("J[_element[_children]]","J[_element].append(_children)"),h("J[_element < _tree]","J[_element].append((_tree).toString())"),h("J[_element > _child]","J[_element].append(J[_child])"),h("J[_element >= _child]","J[_element].append(_child)"),h("J[_element1, _element2]","J[_element1].add(J[_element2])"),h("J[_element1 + _element2]","J[_element1].add(J[_element2])"),h("J[_element >> _pattern]","J[_element].filter(PS[_pattern])"),h("J[_element >>> _pattern]","J[_element].find(PS[_pattern])"),h("J[_element << _pattern]","J[_element].parents(PS[_pattern])"),h("J[(_element)]","(J[_element])"),h("J[[_element]]","[J[_element]]"),h("J[+_expression]","_expression")])}).call(this),c=(function(){var j=function(k){return new a.syntax('"'+k.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"')};return([h("TS[_identifier]",(function(k){return j(("<"+(d(k._identifier.data))+">"))})),h("S[_identifier]",(function(k){return j(d(k._identifier.data))})),h("PS[_identifier]",(function(k){return j(expand(g(k._identifier)).data)}))])}).call(this),b=(function(){var j=function(l){return("("+(l.toString())+').replace(/(\\)/g, "$1$1").replace(/(")/g, "\\$1")')},k=function(l){return function(m){return new a.syntax((""+(expand(g(m._element1)).data)+""+(l)+""+(expand(g(m._element2)).data)+""))}};return([h("P[_element]",(function(l){return new a.syntax(d((function(m){return(m==="_"?"*":m)}).call(this,(l._element.data))))})),h("P[_element._class]",(function(l){return new a.syntax((""+(this(g(l._element)).data)+"."+(d(l._class.data))+""))})),h("P[_element[_attributes]]",(function(l){return new a.syntax((""+(this(g(l._element)).data)+"["+(this(g(l._attributes)))+"]"))})),h("P[_attribute = _value]",(function(l){return new a.syntax((""+(this(g(l._attribute)).data)+'="')+j(l._value)+'}"')})),h("P[(_element)]","P[_element]"),h("P[_element1 +   _element2]",k(", ")),h("P[_element1,    _element2]",k(", ")),h("P[_element1 >>  _element2]",k(" ")),h("P[_element1 >>> _element2]",k(" ")),h("P[_element1 >   _element2]",k(" > ")),h("P[_element1(_element2)]",k(" > ")),h("P[_element /_selector]",(function(l){return new a.syntax((""+(expand(g(l._element)).data)+":"+(d(l._selector.data))+""))})),h("P[_element /_selector(_value)]",(function(l){return new a.syntax((""+(expand(g(l._element)).data)+":"+(d(l._selector.data))+'("#')+"{"+j(l._value)+'}")')}))])}).call(this);return(a.jquery=function(j){return(function(){var k=f("J[_x]"),l=a(a.alternatives(e.concat(c).concat(b)));return((function(m){return(m.modifiers.jquery=function(n){return(function(o){return(((o)&&(this(o))))}).call(this,(l.call(l,k.replace({_x:n._expression}))))}),m}).call(this,(j)))}).call(this)})}).call(this)});

caterwaul('js_all')(function ($) {
  options.input_files.length ? options.input_files *!waul -seq : waul_repl(),

  where [fs                         = require('fs'),
         options                    = {extensions: [], input_files: [], output_pattern: '$1$2.js', use_std: true}
                                      -se [it.input_files = []]
                                      -se- process.argv.slice(2) *![x === '--extension' ? it.extensions /~push/ xs[++xi] :
                                                                    x === '--output'    ? it.output_pattern = xs[++xi]   :
                                                                    x === '--no-std'    ? it.use_std = false             : it.input_files /~push/ x] /seq,

         caterwaul_template         = '(function () {_caterwaul_init; _extensions; return caterwaul.deglobalize()})'.qs,
         extension_tree(filename)   = new $.opaque_tree(fs.readFileSync(filename, 'utf8')),

         build_caterwaul            = caterwaul_template.replace({_caterwaul_init: $ /~replicator/ {core_only: !options.use_std},
                                                                  _extensions:     new $.syntax(';', options.extensions *extension_tree -seq)}) /!$.compile,

         immediate_pattern          = 'caterwaul(_transform)(_function)();'.qs,

         module_pattern             = 'caterwaul.module(_name, _transform, _function);'.qs,
         module_pattern_explicit    = 'caterwaul.module(_name, caterwaul(_transform)(_function));'.qs,
         module_pattern_identity    = 'caterwaul.module(_name, function (_formal) {_body});'.qs,
         module_template            = 'caterwaul.module(_name, _compiled);'.qs,

         output_for(filename)       = filename.replace(/^(.*\/)?([^\/]+)(\.waul)?/, options.output_pattern),
         waul_output(input_file, t) = fs.writeFileSync(input_file /!output_for, t.toString(), 'utf8'),

         waul(input_file)           = input_file /-waul_process/ $.parse(fs.readFileSync(input_file, 'utf8')),
         waul_process(file, tree)   = immediate_pattern       /~match/ tree                                            -re [it ? waul_run(it)             :
                                      module_pattern          /~match/ tree -or- module_pattern_explicit /~match/ tree -re [it ? waul_transform(file, it) :
                                      module_pattern_identity /~match/ tree                                            -re [it ? waul_identity(file, it)  :
                                        raise [new Error('waul: unrecognized toplevel construct in #{file}')]]]],

         waul_repl()                = require('repl').start('waul> ').context /-$.merge/ {$: caterwaul, caterwaul: caterwaul} -where [caterwaul = build_caterwaul()],

         waul_identity(file, m)     = file /-waul_output/ m._,

         waul_transform(file, m)    = file /-waul_output/ module_template.replace({_name: m._name, _compiled: transformed_function})
                              -where [caterwaul            = build_caterwaul(),
                                      transformed_function = caterwaul(m._transform.as_escaped_string())(m._function) /!caterwaul.late_bound_tree],

         waul_run(m)                = caterwaul(m._transform.as_escaped_string())(m._function) /-caterwaul.compile/ {require: require, caterwaul: caterwaul} -re- it()
                              -where [caterwaul = build_caterwaul()]]}, {require: require})(caterwaul);

// Generated by SDoc 
