(function(f){return f(f)})(function(self,undefined){var qw=function(x){return x.split(/\s+/)},id=function(x){return x},se=function(x,f){return f&&f.call(x,x)||x},gensym=(function(n,m){return function(){return 'gensym_'+n.toString(36)+'_'+( ++ m).toString(36)}})( + new Date(),Math.random()*(1<<30)>>>0),bind=function(f,t){return f.binding===t?f:f.original?bind(f.original,t):merge(function(){return f.apply(t,arguments)},{original:f,binding:t})},map=function(f,xs){for(var i=0,ys=[],l=xs.length;i<l; ++ i)ys.push(f(xs[i],i));return ys},hash=function(s){for(var i=0,xs=qw(s),o={},l=xs.length;i<l; ++ i)o[xs[i]]=true;return annotate_keys(o)},merge=function(o){for(var i=1,l=arguments.length,_=null;_=arguments[i],i<l; ++ i)if(_)for(var k in _)has(_,k)&&(o[k]=_[k]);return o},extend=function(f){merge.apply(null,[f.prototype].concat(Array.prototype.slice.call(arguments,1)));return f},annotate_keys=function(o){var max=0;for(var k in o)own.call(o,k)&&(max=k.length>max?k.length:max);o._max_length=max;return o},has=function(o,p){return p&& ! (p.length>o._max_length)&&p!=='_max_length'&&own.call(o,p)},own=Object.prototype.hasOwnProperty,_caterwaul=typeof caterwaul==='undefined'?undefined:caterwaul,syntax_node_inspect=function(x){return x?x.inspect():'(<>)'},syntax_node_tostring=function(x){return x?x.serialize?x.serialize():x.toString():''},node_methods={_replace:function(n){return (n.l=this.l)&&(this.l.r=n),(n.r=this.r)&&(this.r.l=n),this},_append_to:function(n){return n&&n._append(this),this},_reparent:function(n){return this.p&&this.p[0]===this&&(this.p[0]=n),this},_fold_l:function(n){return this._append(this.l&&this.l._unlink(this))},_append:function(n){return (this[this.length ++ ]=n)&&(n.p=this),this},_fold_r:function(n){return this._append(this.r&&this.r._unlink(this))},_sibling:function(n){return n.p=this.p,(this.r=n).l=this},_fold_lr:function(){return this._fold_l()._fold_r()},_wrap:function(n){return n.p=this._replace(n).p,this._reparent(n),delete this.l,delete this.r,this._append_to(n)},_fold_rr:function(){return this._fold_r()._fold_r()},_unlink:function(n){return this.l&&(this.l.r=this.r),this.r&&(this.r.l=this.l),delete this.l,delete this.r,this._reparent(n)},pop:function(){return  -- this.length,this},push:function(x){return this[this.length ++ ]=x,this},id:function(){return this.id||(this.id=gensym())},each:function(f){for(var i=0,l=this.length;i<l; ++ i)f(this[i],i);return this},map:function(f){for(var n=new this.constructor(this),i=0,l=this.length;i<l; ++ i)n.push(f(this[i],i)||this[i]);return n},nmap:function(f){for(var n=new this.constructor(this),i=0,l=this.length,r;i<l; ++ i)(r=f(this[i],i))&&n.push(r);return n},reach:function(f){f(this);this.each(function(n){n&&n.reach(f)});return this},rmap:function(f){var r=f(this);return  ! r||r===this?this.map(function(n){return n&&n.rmap(f)}):r.data===undefined?new this.constructor(r):r},rnmap:function(f){var r=f(this);return r===this?this.nmap(function(n){return n&&n.rnmap(f)}):r&&r.data===undefined?new this.constructor(r):r},clone:function(){return this.rmap(function(){return false})},collect:function(p){var ns=[];this.reach(function(n){p(n)&&ns.push(n)});return ns},replace:function(rs){return this.rnmap(function(n){return own.call(rs,n.data)?rs[n.data]:n})},repopulated_with:function(xs){return new this.constructor(this.data,xs)},change:function(i,x){return se(new this.constructor(this.data,Array.prototype.slice.call(this)),function(n){n[i]=x})},compose_single:function(i,f){return this.change(i,f(this[i]))},traverse:function(f){f({entering:this});f({exiting:this.each(function(n){n&&n.traverse(f)})});return this},flatten:function(d){d=d||this.data;return d!==this.data?this.as(d): ! (has(parse_lr,d)&&this.length)?this:has(parse_associates_right,d)?se(new this.constructor(d),bind(function(n){for(var i=this;i&&i.data===d;i=i[1])n.push(i[0]);n.push(i)},this)):se(new this.constructor(d),bind(function(n){for(var i=this,ns=[];i.data===d;i=i[0])i[1]&&ns.push(i[1]);ns.push(i);for(i=ns.length-1;i>=0; -- i)n.push(ns[i])},this))},unflatten:function(){var right=has(parse_associates_right,this.data);return this.length<=2?this:se(new this.constructor(this.data),bind(function(n){if(right)for(var i=0,l=this.length-1;i<l; ++ i)n=n.push(this[i]).push(i<l-2?new this.constructor(this.data):this[i])[1];else for(var i=this.length-1;i>=1; -- i)n=n.push(i>1?new this.constructor(this.data):this[0]).push(this[i])[0]},this))},as:function(d){return this.data===d?this:new this.constructor(d).push(this)},is_string:function(){return /['"]/.test(this.data.charAt(0))},as_escaped_string:function(){return this.data.substr(1,this.data.length-2)},is_number:function(){return /^-?(0x|\d|\.\d+)/.test(this.data)},as_number:function(){return Number(this.data)},is_boolean:function(){return this.data==='true'||this.data==='false'},as_boolean:function(){return this.data==='true'},is_regexp:function(){return /^\/./.test(this.data)},as_escaped_regexp:function(){return this.data.substring(1,this.data.lastIndexOf('/'))},has_grouped_block:function(){return has(parse_r_until_block,this.data)},is_block:function(){return has(parse_block,this.data)},is_blockless_keyword:function(){return has(parse_r_optional,this.data)},is_null_or_undefined:function(){return this.data==='null'||this.data==='undefined'},is_constant:function(){return this.is_number()||this.is_string()||this.is_boolean()||this.is_regexp()||this.is_null_or_undefined()},left_is_lvalue:function(){return /=$/.test(this.data)||/\+\+$/.test(this.data)||/--$/.test(this.data)},is_empty:function(){return  ! this.length},has_parameter_list:function(){return this.data==='function'||this.data==='catch'},has_lvalue_list:function(){return this.data==='var'||this.data==='const'},is_dereference:function(){return this.data==='.'||this.data==='[]'},is_invocation:function(){return this.data==='()'},is_contextualized_invocation:function(){return this.is_invocation()&&this[0]&&this[0].is_dereference()},is_invisible:function(){return has(parse_invisible,this.data)},is_binary_operator:function(){return has(parse_lr,this.data)},is_prefix_unary_operator:function(){return has(parse_r,this.data)},is_postfix_unary_operator:function(){return has(parse_l,this.data)},is_unary_operator:function(){return this.is_prefix_unary_operator()||this.is_postfix_unary_operator()},accepts:function(e){return parse_accepts[this.data]&&this.accepts[parse.data]===(e.data||e)},bindings:function(hash){var result=hash||{};this.reach(function(n){if(n.binds_a_value)result[n.data]=n.value});return result},match:function(pattern){return macro_try_match(pattern,this)},ends_with_block:function(){var block_index=parse_r_until_block[this.data],block=this[block_index];return this.data==='{'||has(parse_r_until_block,this.data)&&(this.data!=='function'||this.length===3)&&block&&block.ends_with_block()},toString:function(){return this.inspect()},inspect:function(){return (this.l?'(left) <- ':'')+'('+this.data+(this.length?' '+map(syntax_node_inspect,this).join(' '):'')+')'+(this.r?' -> '+this.r.inspect():'')},serialize:function(xs){var ys=xs||[],op=this.data,sop=' '+op+' ',sopt=/\w/.test(op)?sop:op,push=function(f,xs){for(var i=0,l=xs.length;i<l; ++ i)ys.push(f(xs[i]));return ys};has(parse_invisible,op)?push(syntax_node_tostring,this):has(parse_invocation,op)?push(syntax_node_tostring,[this[0],op.charAt(0),this[1],op.charAt(1)]):has(parse_ternary,op)?push(syntax_node_tostring,[this[0],op,this[1],parse_group[op],this[2]]):has(parse_group,op)?ys.push(op)&&push(syntax_node_tostring,this)&&ys.push(parse_group[op]):has(parse_lr,op)?this.length?push(syntax_node_tostring,[this[0],this[1]?sopt:'',this[1],this[2]?sopt:'',this[2]]):ys.push(op):has(parse_r,op)||has(parse_r_optional,op)?ys.push(op.replace(/^u/,' ')+' ')&&ys.push(this[0]?this[0].serialize():''):has(parse_r_until_block,op)?has(parse_accepts,op)&&this[1]&&this[2]&&parse_accepts[op]===this[2].data&& ! this[1].ends_with_block()?ys.push(op)&&push(syntax_node_tostring,[this[0],this[1],';',this[2]]):ys.push(op)&&push(syntax_node_tostring,this):has(parse_l,op)?ys.push(this[0]?this[0].serialize():'')&&ys.push(sop):ys.push(op);return xs?ys:ys.join('')}},ref=extend(function(value){if(value instanceof this.constructor){this.value=value.value;this.data=value.data}else {this.value=value;this.data=gensym()}},{length:0,binds_a_value:true},node_methods),syntax_node=extend(function(data){if(data instanceof this.constructor)this.data=data.data,this.length=0;else {this.data=data&&data.toString();this.length=0;for(var i=1,l=arguments.length,_;_=arguments[i],i<l; ++ i)for(var j=0,lj=_.length,it,itc;_ instanceof Array?(it=_[j],j<lj):(it=_, ! j); ++ j)this._append((itc=it.constructor)===String||itc===Number||itc===Boolean?new this.constructor(it):it)}},node_methods),lex_op=hash('. new ++ -- u++ u-- u+ u- typeof u~ u! ! * / % + - << >> >>> < > <= >= instanceof in == != === !== & ^ | && || ? = += -= *= /= %= &= |= ^= <<= >>= >>>= : , '+'return throw case var const break continue void else u; ;'),lex_table=function(s){for(var i=0,xs=[false];i<8; ++ i)xs.push.apply(xs,xs);for(var i=0,l=s.length;i<l; ++ i)xs[s.charCodeAt(i)]=true;return xs},lex_float=lex_table('.0123456789'),lex_decimal=lex_table('0123456789'),lex_integer=lex_table('0123456789abcdefABCDEFx'),lex_exp=lex_table('eE'),lex_space=lex_table(' \n\r\t'),lex_bracket=lex_table('()[]{}'),lex_opener=lex_table('([{'),lex_punct=lex_table('+-*/%&|^!~=<>?:;.,'),lex_eol=lex_table('\n\r'),lex_regexp_suffix=lex_table('gims'),lex_quote=lex_table('\'"/'),lex_slash='/'.charCodeAt(0),lex_star='*'.charCodeAt(0),lex_back='\\'.charCodeAt(0),lex_x='x'.charCodeAt(0),lex_dot='.'.charCodeAt(0),lex_zero='0'.charCodeAt(0),lex_postfix_unary=hash('++ --'),lex_ident=lex_table('$_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'),parse_reduce_order=map(hash,['function','( [ . [] ()','new delete','u++ u-- ++ -- typeof u~ u! u+ u-','* / %','+ -','<< >> >>>','< > <= >= instanceof in','== != === !==','&','^','|','&&','||','case','?','= += -= *= /= %= &= |= ^= <<= >>= >>>=',':',',','return throw break continue void','var const','if else try catch finally for switch with while do',';']),parse_associates_right=hash('= += -= *= /= %= &= ^= |= <<= >>= >>>= ~ ! new typeof u+ u- -- ++ u-- u++ ? if else function try catch finally for switch case with while do'),parse_inverse_order=(function(xs){for(var o={},i=0,l=xs.length;i<l; ++ i)for(var k in xs[i])has(xs[i],k)&&(o[k]=i);return annotate_keys(o)})(parse_reduce_order),parse_index_forward=(function(rs){for(var xs=[],i=0,l=rs.length,_=null;_=rs[i],xs[i]=true,i<l; ++ i)for(var k in _)if(has(_,k)&&(xs[i]=xs[i]&& ! has(parse_associates_right,k)))break ;return xs})(parse_reduce_order),parse_lr=hash('[] . () * / % + - << >> >>> < > <= >= instanceof in == != === !== & ^ | && || = += -= *= /= %= &= |= ^= <<= >>= >>>= , : ;'),parse_r_until_block=annotate_keys({'function':2,'if':1,'do':1,'catch':1,'try':1,'for':1,'while':1,'with':1}),parse_accepts=annotate_keys({'if':'else','do':'while','catch':'finally','try':'catch'}),parse_invocation=hash('[] ()'),parse_r_optional=hash('return throw break continue else'),parse_also_expression=hash('function'),parse_r=hash('u+ u- u! u~ u++ u-- new typeof finally var const void delete'),parse_block=hash('; {'),parse_invisible=hash('i;'),parse_l=hash('++ --'),parse_group=annotate_keys({'(':')','[':']','{':'}','?':':'}),parse_ambiguous_group=hash('[ ('),parse_ternary=hash('?'),parse_not_a_value=hash('function if for while catch'),parse=function(input){var s=input.toString(),mark=0,c=0,re=true,esc=false,dot=false,exp=false,close=0,t='',i=0,l=s.length,cs=function(i){return s.charCodeAt(i)},grouping_stack=[],gs_top=null,head=null,parent=null,indexes=map(function(){return []},parse_reduce_order),invocation_nodes=[],all_nodes=[],new_node=function(n){return all_nodes.push(n),n},push=function(n){return head?head._sibling(head=n):(head=n._append_to(parent)),new_node(n)};while((mark=i)<l){while(lex_space[c=cs(i)]&&i<l)mark= ++ i;esc=exp=dot=t=false;if(lex_bracket[c]){t= !  !  ++ i;re=lex_opener[c]}else if(c===lex_slash&&cs(i+1)===lex_star&&(i+=2)){while( ++ i<l&&cs(i)!==lex_slash||cs(i-1)!==lex_star);t= !  ++ i}else if(c===lex_slash&&cs(i+1)===lex_slash){while( ++ i<l&& ! lex_eol[cs(i)]);t=false}else if(lex_quote[c]&&(close=c)&&re&& ! (re= ! (t=s.charAt(i)))){while( ++ i<l&&(c=cs(i))!==close||esc)esc= ! esc&&c===lex_back;while( ++ i<l&&lex_regexp_suffix[cs(i)]);t=true}else if(c===lex_zero&&lex_integer[cs(i+1)]){while( ++ i<l&&lex_integer[cs(i)]);re= ! (t=true)}else if(lex_float[c]&&(c!==lex_dot||lex_decimal[cs(i+1)])){while( ++ i<l&&(lex_decimal[c=cs(i)]||(dot^(dot|=c===lex_dot))||(exp^(exp|=lex_exp[c]&& ++ i))));while(i<l&&lex_decimal[cs(i)]) ++ i;re= ! (t=true)}else if(lex_punct[c]&&(t=re?'u':'',re=true)){while(i<l&&lex_punct[cs(i)]&&has(lex_op,t+s.charAt(i)))t+=s.charAt(i ++ );re= ! has(lex_postfix_unary,t)}else {while( ++ i<l&&lex_ident[cs(i)]);re=has(lex_op,t=s.substring(mark,i))}if(i===mark)throw new Error('Caterwaul lex error at "'+s.substr(mark,40)+'" with leading context "'+s.substr(mark-40,40)+'" (probably a Caterwaul bug)');if(t===false)continue ;t=t===true?s.substring(mark,i):t==='u;'?';':t;t===gs_top?(grouping_stack.pop(),gs_top=grouping_stack[grouping_stack.length-1],head=head?head.p:parent,parent=null):(has(parse_group,t)?(grouping_stack.push(gs_top=parse_group[t]),parent=push(new_node(new syntax_node(t))),head=null):push(new_node(new syntax_node(t))),has(parse_inverse_order,t)&&indexes[parse_inverse_order[t]].push(head||parent));re|=t===')'&&head.l&&has(parse_r_until_block,head.l.data)}for(var i=0,l=indexes.length,forward,_;_=indexes[i],forward=parse_index_forward[i],i<l; ++ i)for(var j=forward?0:_.length-1,lj=_.length,inc=forward?1: - 1,node,data;node=_[j],data=node&&node.data,forward?j<lj:j>=0;j+=inc)if(has(parse_lr,data))node._fold_lr();else if(has(parse_ambiguous_group,data)&&node.l&&(node.l.data==='.'|| ! (has(lex_op,node.l.data)||has(parse_not_a_value,node.l.data))))invocation_nodes.push(node.l._wrap(new_node(new syntax_node(data+parse_group[data]))).p._fold_r());else if(has(parse_l,data))node._fold_l();else if(has(parse_r,data))node._fold_r();else if(has(parse_ternary,data)){node._fold_lr();var temp=node[1];node[1]=node[0];node[0]=temp}else if(has(parse_r_until_block,data)&&node.r&&node.r.data!==':'){for(var count=0,limit=parse_r_until_block[data];count<limit&&node.r&& ! has(parse_block,node.r.data); ++ count)node._fold_r();node.r&&node.r.data!==';'&&node._fold_r();if(has(parse_accepts,data)&&parse_accepts[data]===(node.r&&node.r.r&&node.r.r.data))node._fold_r().pop()._fold_r();else if(has(parse_accepts,data)&&parse_accepts[data]===(node.r&&node.r.data))node._fold_r()}else if(has(parse_r_optional,data))node.r&&node.r.data!==';'&&node._fold_r();for(var i=all_nodes.length-1,_;_=all_nodes[i],i>=0; -- i)_.r&&_._wrap(new syntax_node('i;')).p._fold_r();for(var i=0,l=invocation_nodes.length,_,child;_=invocation_nodes[i],i<l; ++ i)(child=_[1]=_[1][0])&&(child.p=_);while(head.p)head=head.p;for(var i=all_nodes.length-1;i>=0; -- i)delete all_nodes[i].p;return head},macro_array_push=Array.prototype.push,macro_try_match=function(pattern,t){if(pattern.data==='_')return [t];if(pattern.data!==t.data||pattern.length!==t.length)return null;for(var i=0,l=pattern.length,wildcards=[],match=null;i<l; ++ i)if(match=macro_try_match(pattern[i],t[i]))macro_array_push.apply(wildcards,match);else return null;return wildcards},macro_expand=function(t,macros,expanders,context){return t.rmap(function(n){for(var i=macros.length-1,macro,match,replacement;i>=0&&(macro=macros[i]); -- i)if((match=macro_try_match(macro,n))&&(replacement=expanders[i].apply(context,match)))return replacement})},compile=function(tree,environment){var vars=[],values=[],bindings=merge({},environment||{},tree.bindings()),s=gensym();for(var k in bindings)if(has(bindings,k))vars.push(k),values.push(bindings[k]);var code=map(function(v){return v==='this'?'':'var '+v+'='+s+'.'+v},vars).join(';')+';return('+tree.serialize()+')';try{return (new Function(s,code)).call(bindings['this'],bindings)}catch(e){throw new Error('Caught '+e+' while compiling '+code)}},associator_for=function(f){return function(name,behavior,value){return f[name]=(f.behaviors[f.attributes[name]=behavior]||id).call(f,value),f}},shallow_copy=function(x){return x&&(x.constructor===Array?x.slice():x.clone?x.clone():merge({},x))},copy_of=function(f){var g=merge(function(){return g.init.apply(g,arguments)},{behaviors:shallow_copy(f.behaviors),attributes:{}});return se(g,function(g){(g.associate=associator_for(g))('behavior','method',function(name,definition){this.behaviors[name]=definition;return this.associate(name,'method',function(attribute,value){return this.associate(attribute,name,value)})}).behavior('method',g.behaviors.method);for(var k in f.attributes)has(f.attributes,k)&&g.associate(k,f.attributes[k],f[k])})},replica=se(function(){return copy_of({behaviors:{method:function(v){return bind(v,this)}}}).behavior('field').behavior('shallow',shallow_copy)},function(f){f.init=f}),configurable=function(f){return f.shallow('configurations',{}).shallow('has',{}).method('configuration',function(name,f){this.configurations[name]=f;return this}).method('namespace',function(s){return this[s]||this.shallow(s,{})[s]}).method('clone',function(){return arguments.length?this.clone().configure.apply(null,arguments):copy_of(this)}).method('configure',function(){for(var i=0,l=arguments.length,_;_=arguments[i],i<l; ++ i)if(_.constructor===String)for(var cs=qw(arguments[i]),j=0,lj=cs.length;_=cs[j],j<lj; ++ j)if(this.configurations[_])this.has[_]||(this.has[_]=this.configurations[_].call(this,this)||this);else throw new Error('error: configuration "'+_+'" does not exist');else _ instanceof Array?this.configure.apply(this,_.slice()):_.call(this,this);return this})},macroexpansion=function(f){return f.shallow('macro_patterns',[]).method('macro',function(pattern,expansion){return this.macro_patterns.push(pattern),this.macro_expanders.push(expansion),this}).shallow('macro_expanders',[]).method('macroexpand',function(t){return macro_expand(t,this.macro_patterns,this.macro_expanders,this)}).method('rmacro',function(pattern,expander){if( ! expander.apply)throw new Error('rmacro: Cannot define macro with non-function expander');else return this.macro(pattern,function(){var t=expander.apply(this,arguments);return t&&this.macroexpand(t)})})},composition=function(f){return f.shallow('after_functions',[]).method('after',function(){if(arguments.length){for(var i=0,l=arguments.length;i<l; ++ i)this.after_functions.push(arguments[i]);return this}else return this.after_functions})},caterwaul_core=function(f){return configurable(f).configure(macroexpansion,composition).method('tconfiguration',function(configs,name,f,bindings){this.configurations[name]=this.clone(configs)(f,bindings);return this}).field('syntax',syntax_node).field('ref',ref).field('parse',parse).field('compile',compile).field('gensym',gensym).field('map',map).field('self',self).field('macroexpansion',macroexpansion).field('replica',replica).field('configurable',configurable).field('caterwaul',caterwaul_core).field('decompile',parse).field('composition',composition).field('global',function(){return caterwaul_global}).method('init',function(f,environment){var result=f.constructor===this.syntax?this.macroexpand(f):this.compile(this(this.decompile(f)),environment);if(f.constructor===this.syntax)for(var i=0,l=this.after_functions.length;i<l; ++ i)result=this.after_functions[i](result);return result}).method('reinitialize',function(transform,erase_configurations){var c=transform(this.self),result=c(c).deglobalize();erase_configurations||(result.configurations=this.configurations);return result}).shallow('util',{extend:extend,merge:merge,se:se,macro_try_match:macro_try_match,id:id,bind:bind,map:map,qw:qw}).method('magic',(function(table){return function(name){return table[name]||(table[name]={})}})({}))},caterwaul_global=caterwaul=caterwaul_core(merge(replica(),{deglobalize:function(){caterwaul=_caterwaul;return this}}));return caterwaul_global});caterwaul.configuration('std.qs',function(){this.macro(this.parse('qs[_]'),function(tree){return new this.ref(tree)}).macro(this.parse('qse[_]'),function(tree){return new this.ref(this.macroexpand(tree))}).macro(this.parse('literal[_]'),function(tree){return tree})}).tconfiguration('std.qs','std.qg',function(){this.rmacro(qs[qg[_]],function(expression){return expression.as('(')})}).tconfiguration('std.qs std.qg','std.fn',function(){this.configure('std.qg').rmacro(qs[fn[_][_]],function(vars,expression){return qs[qg[function(vars){return expression}]].replace({vars:vars,expression:expression})}).rmacro(qs[fn_[_]],function(expression){return qs[qg[function(){return expression}]].replace({expression:expression})}).rmacro(qs[fb[_][_]],function(vars,expression){return qse[fn[_t][fn_[fn[vars][e].apply(_t,arguments)]](this)].replace({_t:this.gensym(),vars:vars,e:expression})}).rmacro(qs[fb_[_]],function(expression){return qse[fn[_t][fn_[fn_[e].apply(_t,arguments)]](this)].replace({_t:this.gensym(),e:expression})}).rmacro(qs[fc[_][_]],function(vars,body){return qse[qg[fn[vars][body,undefined]]].replace({vars:vars,body:body})}).rmacro(qs[fc_[_]],function(body){return qse[qg[fn[vars][body,undefined]]].replace({body:body})})}).tconfiguration('std.qs std.qg std.fn','std.obj',function(){this.configure('std.qg std.fn').rmacro(qs[_/mb/_],fn[object,method][qse[qg[fn[_o][_o.m&&fn_[_o.m.apply(_o,arguments)]]](o)].replace({_o:this.gensym(),o:object,m:method})]).rmacro(qs[_/mb[_]],fn[object,method][qse[qg[fn[_o,_m][_o[_m]&&fn_[_o[_m].apply(_o,arguments)]]](o,m)].replace({_o:this.gensym(),_m:this.gensym(),o:object,m:method})]).rmacro(qs[_/se._[_]],fn[v,n,b][qse[qg[fn[n][b,n]].call(this,v)].replace({b:b,n:n,v:v})]).rmacro(qs[_/se[_]],fn[v,b][qse[v/se._[b]].replace({b:b,v:v})]).rmacro(qs[_/re._[_]],fn[v,n,b][qse[qg[fn[n][b]].call(this,v)].replace({b:b,n:n,v:v})]).rmacro(qs[_/re[_]],fn[v,b][qse[v/re._[b]].replace({b:b,v:v})])}).tconfiguration('std.qs std.qg std.fn','std.bind',function(){this.configure('std.qg');var lf=fb[form][this.rmacro(form,l_expander)],lsf=fb[form][this.rmacro(form,l_star_expander)],l_star_expander=fb[vars,expression][qs[qg[function(){var vars;return expression}].call(this)].replace({vars:this.macroexpand(vars),expression:expression})],l_expander=fb[vars,expression][vars=this.macroexpand(vars).flatten(','),qs[qg[function(vars){return e}].call(this,values)].replace({vars:vars.map(fn[n][n[0]]).unflatten(),e:expression,values:vars.map(fn[n][n[1]]).unflatten()})];lf(qs[l[_] in _]),lf(qs[l[_][_]]),lf(this.parse('let [_] in _')),lf(this.parse('let [_][_]')).rmacro(qs[_,where[_]],fn[expression,vars][l_expander(vars,expression)]);lsf(qs[l*[_] in _]),lsf(qs[l*[_][_]]),lsf(this.parse('let*[_] in _')),lsf(this.parse('let*[_][_]')).rmacro(qs[_,where*[_]],fn[expression,vars][l_star_expander(vars,expression)])}).tconfiguration('std.qs std.qg std.fn','std.lvalue',function(){this.rmacro(qs[_(_)=_],fn[base,params,value][qs[base=qg[function(params){return value}]].replace({base:base,params:params,value:value})])}).tconfiguration('std.qs std.fn','std.cond',function(){this.configure('std.qg').rmacro(qs[_,when[_]],fn[expression,cond][qs[qg[l]&&qg[r]].replace({l:cond,r:expression})]).rmacro(qs[_,unless[_]],fn[expression,cond][qs[ ! qg[l]&&qg[r]].replace({l:cond,r:expression})])}).tconfiguration('std.qs std.fn std.bind std.lvalue','std.defmacro',function(){l[wildcard(n)=n.data.constructor===String&&n.data.charAt(0)==='_'&&'_'] in this.macro(qs[defmacro[_][_]],fn[pattern,expansion][this.rmacro(pattern,this.compile(this.macroexpand(expansion))),qs[null]]).macro(qs[defsubst[_][_]],fn[pattern,expansion][this.rmacro(pattern.rmap(wildcard),l[wildcards=pattern.collect(wildcard)] in fn_[l[hash={},as=arguments][this.util.map(fn[v,i][hash[v.data]=as[i]],wildcards),expansion.replace(hash)]]),qs[null]])}).tconfiguration('std.qs std.fn std.bind','std.with_gensyms',function(){this.rmacro(qs[with_gensyms[_][_]],fn[vars,expansion][l[bindings={}][vars.flatten(',').each(fb[v][bindings[v.data]=this.gensym()]),qs[qs[_]].replace({_:expansion.replace(bindings)})]])}).tconfiguration('std.qs std.fn','std.compile_eval',function(){this.macro(qs[compile_eval[_]],fn[e][new this.ref(this.compile(this.macroexpand(qs[fn_[_]].replace({_:e}))).call(this))])}).tconfiguration('std.qs std.fn','std.ref',function(){this.macro(qs[caterwaul],fn_[new this.ref(this)])}).tconfiguration('std.qs std.bind std.lvalue','std.locally',function(){l*[t=this,handler(c,e)=t.clone(c.is_string()?c.as_escaped_string():c.data).macroexpand(e)] in this.macro(qs[locally[_][_]],handler).macro(qs[locally._[_]],handler)}).tconfiguration('std.qs std.fn std.bind','std.string',function(){this.rmacro(qs[_],fn[string][string.is_string()&&/#\{[^\}]+\}/.test(string.data)&&l*[q=string.data.charAt(0),s=string.as_escaped_string(),eq=new RegExp('\\\\'+q,'g'),strings=s.split(/#\{[^\}]+\}/),xs=[],result=new this.syntax('+')][s.replace(/#\{([^\}]+)\}/g,fn[_,s][xs.push(s),'']),this.util.map(fb[x,i][result.push(new this.syntax(q+(i<strings.length?strings[i]:'')+q)).push(new this.syntax('(',this.parse(xs[i].replace(eq,q))))],xs),new this.syntax('(',result.push(new this.syntax(q+(xs.length<strings.length?strings[strings.length-1]:'')+q)).unflatten())]])}).configuration('std',function(){this.configure('std.qs std.qg std.bind std.lvalue std.cond std.fn std.obj std.defmacro std.with_gensyms std.ref std.locally std.compile_eval std.string')});caterwaul.tconfiguration('std','opt.unroll',function(){this.rmacro(qs[opt.unroll[_,_][_]],fn[variable,iterations,body][with_gensyms[l,rs,es,j][qg[function(l){for(var rs=l>=0&&l>>3,es=l>=0&&l&7,_i_=0;_i_<es; ++ _i_)_body_;for(var j=0;j<rs; ++ j){_body_;_i_ ++ ;_body_;_i_ ++ ;_body_;_i_ ++ ;_body_;_i_ ++ ;_body_;_i_ ++ ;_body_;_i_ ++ ;_body_;_i_ ++ ;_body_;_i_ ++ };return l}].call(this,_iterations_)].replace({_i_:variable,_body_:body,_iterations_:iterations})])});caterwaul.configuration('opt',function(){this.configure('opt.unroll')});caterwaul.configuration('continuation.core',function(){this.shallow('continuation',{})}).tconfiguration('std','continuation.unwind',function(){this.configure('std.fn continuation.core').continuation/se[_.unwind_protect=function(escape,f){try{return f()}catch(e){return escape(e)}},_.unwind=function(e){throw e}];this.rmacro(qs[unwind_protect[_][_]],fn[escape,body][qse[_f(fb[e][_escape],fb_[_body])].replace({_f:qs[caterwaul.continuation.unwind_protect],_escape:escape,_body:body})]).rmacro(qs[unwind[_]],fn[e][qs[caterwaul.continuation.unwind(_e)].replace({_e:e})])}).tconfiguration('std','continuation.cps',function(){l*[cps_convert(v,f,b,bound)=qse[l[_=_c][_f]].replace({_c:caterwaul.macroexpand(qs[_f[_v][_b]].replace({_f:bound?qs[fb]:qs[fn]})).replace({_v:v.as('(')[0],_b:b}),_f:f}),l_cps_def(t,form,bound)=l[inductive(cs,v,f,b)=qs[l/cps[cs][_f]].replace({cs:cs,_f:cps_convert(v,f,b,bound)}),base(v,f,b)=cps_convert(v,f,b,bound)] in t.rmacro(qs[l/_form[_,_< - _] in _].replace({_form:form}),inductive).rmacro(caterwaul.parse('let/#{form.serialize()}[_, _ <- _] in _'),inductive).rmacro(qs[l/_form[_< - _] in _].replace({_form:form}),base).rmacro(caterwaul.parse('let/#{form.serialize()}[   _ <- _] in _'),base).rmacro(qs[l/_form[_,_< - _][_]].replace({_form:form}),inductive).rmacro(caterwaul.parse('let/#{form.serialize()}[_, _ <- _][_]'),inductive).rmacro(qs[l/_form[_< - _][_]].replace({_form:form}),base).rmacro(caterwaul.parse('let/#{form.serialize()}[   _ <- _][_]'),base),cps_def(t,form,bound)=t.rmacro(qs[_/_form[_]].replace({_form:form}),fn[f,b][qse[_f/_form._[_b]].replace({_form:form,_f:f,_b:b})]).rmacro(qs[_/_form._[_]].replace({_form:form}),fn[f,v,b][qse[l[_=_c][_f]].replace({_c:caterwaul.macroexpand(qs[_f[_v][_b]].replace({_f:bound?qs[fb]:qs[fn]})).replace({_v:v,_b:b}),_f:f})])] in this.configure('std.fn continuation.core')/se[cps_def(_,qs[cps],false),cps_def(_,qs[cpb],true),l_cps_def(_,qs[cps],false),l_cps_def(_,qs[cpb],true)]}).tconfiguration('std','continuation.delimited',function(){l[magic=this.configure('std.qg continuation.core').continuation.magic=this.magic('continuation.delimited')] in this.continuation/se[_.call_cc=function(f){var escaped=false,cc=function(x){escaped=true;throw x},frame={magic:magic,continuation:f,parameters:[cc]};try{while((frame=frame.continuation.apply(this,frame.parameters))&&frame&&frame.magic===magic);return frame}catch(e){if(escaped)return e;else throw e}},_.call_tail()={magic:magic,continuation:this,parameters:arguments}];this.rmacro(qs[call/cc[_]],fn[f][qs[qg[caterwaul.continuation.call_cc.call(this,_f)]].replace({_f:f})]).rmacro(qs[call/tail[_(_)]],fn[f,args][qs[qg[caterwaul.continuation.call_tail.call(_f,_args)]].replace({_f:f,_args:args})])}).configuration('continuation',function(){this.configure('continuation.core continuation.unwind continuation.cps continuation.delimited')});caterwaul.tconfiguration('std','seq.core',function(){this.shallow('seq',{core:fn_[null]/se[_.prototype=[]/se.p[p.constructor=_]]})}).tconfiguration('std opt','seq.finite.core',function(){this.configure('seq.core').seq.finite=fc[xs][this.length=this.l=xs?opt.unroll[i,xs.size?xs.size():xs.length][this[i]=xs[i]]:0]/se.c[c.prototype=new this.seq.core()/se[_.size()=this.l||this.length,_.slice()=[]/se[opt.unroll[i,this.size()][_.push(this[i])]],_.constructor=c]]}).tconfiguration('std','seq.finite.serialization',function(){this.configure('seq.finite.core').seq.finite.prototype/se[_.toString()='seq[#{this.slice().join(", ")}]',_.join(x)=this.slice().join(x)]}).tconfiguration('std opt','seq.finite.mutability',function(){l[push=Array.prototype.push,slice=Array.prototype.slice] in this.configure('seq.finite.core').seq.finite.prototype/se[_.push()=l[as=arguments] in opt.unroll[i,as.length][this[this.l ++ ]=as[i]]/re[this.length=this.l,this],_.pop()=this[ -- this.l]/se[delete this[this.length=this.l]],_.concat(xs)=new this.constructor(this)/se[_.push.apply(_,slice.call(xs))]]}).tconfiguration('std','seq.finite.object',function(){l[own=Object.prototype.hasOwnProperty] in this.configure('seq.finite.core').seq.finite/se[_.keys(o,all)=new _()/se[(function(){for(var k in o)if(all||own.call(o,k))_.push(k)})()],_.values(o,all)=new _()/se[(function(){for(var k in o)if(all||own.call(o,k))_.push(o[k])})()],_.pairs(o,all)=new _()/se[(function(){for(var k in o)if(all||own.call(o,k))_.push([k,o[k]])})()],_.prototype.object(o)=(o||{})/se[this.each(fn[p][_[p[0]]=p[1]])]]}).tconfiguration('std opt','seq.finite.traversal',function(){this.configure('seq.finite.core seq.finite.mutability').seq.finite.prototype/se[_.map(f)=new this.constructor()/se[opt.unroll[i,this.l][_.push(f.call(this,this[i],i))]],_.filter(f)=new this.constructor()/se[opt.unroll[i,this.l][_.push(this[i]),when[f.call(this,this[i],i)]]],_.each(f)=this/se[opt.unroll[i,_.l][f.call(_,_[i],i)]],_.reversed()=new this.constructor()/se[l[l=this.l] in opt.unroll[i,l][_.push(this[l-i-1])]],_.flat_map(f)=new this.constructor()/se[this.each(fn[x,xi][(f.call(this,x,xi)/re.xs[xs.each?xs:new this.constructor(xs)]).each(fn[x][_.push(x)])])],_.foldl(f,x)=l[x=arguments.length>1?x:this[0],xi=2-arguments.length][opt.unroll[i,this.l-xi][x=f.call(this,x,this[i+xi],i+xi)],x,when[this.l>=xi]],_.foldr(f,x)=l[x=arguments.length>1?x:this[this.l-1],xi=3-arguments.length,l=this.l][opt.unroll[i,l-(xi-1)][x=f.call(this,this[l-(i+xi)],x,l-(i+xi))],x,when[l>=xi-1]]]}).tconfiguration('std opt','seq.finite.zip',function(){this.configure('seq.finite.traversal').seq.finite/se[_.prototype.zip()=l[as=new seq([this].concat(slice.call(arguments))),options={f:fn_[new seq(arguments)],outer:false}][caterwaul.util.merge(options,as.pop()),when[as[as.size()-1].constructor===Object],l[l=as.map(fn[x][x.size?x.size():x.length]).foldl(options.outer?fn[x,y][Math.max(x,y)]:fn[x,y][Math.min(x,y)]),f=options.f] in new this.constructor()/se[opt.unroll[i,l][_.push(f.apply({i:i},as.map(fn[x][x[i]]).slice()))]]],where[seq=_,slice=Array.prototype.slice]]}).tconfiguration('std opt continuation','seq.finite.quantification',function(){this.configure('seq.finite.core').seq.finite.prototype/se[_.exists(f)=call/cc[fb[cc][opt.unroll[i,this.l][f.call(this,this[i],i)/re[_&&cc(_)]],false]],_.forall(f)= ! this.exists(fn_[ ! f.apply(this,arguments)])]}).tconfiguration('std','seq.infinite.core',function(){this.configure('seq.core').seq.infinite=fn_[null]/se[_.prototype=new this.seq.core()/se[_.constructor=ctor],where[ctor=_]]/se[_.def(name,ctor,h,t)=i[name]=ctor/se[_.prototype=new i()/se[_.h=h,_.t=t,_.constructor=ctor]],where[i=_],_.def('cons',fn[h,t][this._h=h,this._t=t],fn_[this._h],fn_[this._t]),_.def('k',fn[x][this._x=x],fn_[this._x],fn_[this])]}).tconfiguration('std','seq.infinite.y',function(){this.configure('seq.infinite.core').seq.infinite.def('y',fc[f,x][this._f=f,this._x=x],fn_[this._x],fn_[new this.constructor(this._f,this._f(this._x))])}).tconfiguration('std continuation','seq.infinite.transform',function(){this.configure('seq.infinite.core').seq.infinite/se[_.prototype.map(f)=new _.map(f,this),_.def('map',fc[f,xs][this._f=f,this._xs=xs],fn_[this._f(this._xs.h())],fn_[new this.constructor(this._f,this._xs.t())]),_.prototype.filter(f)=new _.filter(f,this),_.def('filter',fc[f,xs][this._f=f,this._xs=l*[next(s)(cc)=f(s.h())?cc(s):call/tail[next(s.t())(cc)]] in call/cc[next(xs)]],fn_[this._xs.h()],fn_[new this.constructor(this._f,this._xs.t())])]}).tconfiguration('std continuation','seq.infinite.traversal',function(){l[finite=this.configure('seq.finite.core seq.finite.mutability').seq.finite] in this.configure('seq.infinite.core').seq.infinite.prototype/se[_.drop(f)=l*[next(s)(cc)=f(s.h())?call/tail[next(s.t())(cc)]:cc(s)] in call/cc[next(this)],_.take(f)=l*[xs=new finite(),next(s)(cc)=l[h=s.h()][f(h)?(xs.push(h),call/tail[next(s.t())(cc)]):cc(xs)]] in call/cc[next(this)]]}).tconfiguration('std opt','seq.numeric',function(){this.configure('seq.infinite.core seq.infinite.y seq.finite.core').seq/se[_.naturals_from(x)=new _.infinite.y(fn[n][n+1],x),_.naturals=_.naturals_from(0),_.n(l,u,s)=l[lower=arguments.length>1?l:0,upper=arguments.length>1?u:l][l[step=Math.abs(s||1)*(lower<upper?1: - 1)] in new _.infinite.y(fn[n][n+step],lower).take(fn[x][(upper-lower)*(upper-x)>0])]]}).tconfiguration('std opt continuation','seq.dsl',function(){this.configure('seq.core seq.infinite.y seq.finite.core seq.finite.zip seq.finite.traversal seq.finite.mutability').seq.dsl=caterwaul.global().clone()/se[_.prefix_substitute(tree,prefix)=tree.rmap(fn[n][new n.constructor('#{prefix}#{n.data.substring(1)}'),when[n.data.charAt(0)==='_']]),_.define_functional(op,expansion,xs)=trees_for(op).map(fn[t,i][_.macro(t,fn[l,v,r][expansion.replace({_x:_.macroexpand(l),_y:i>=8?v:qs[fn[xs][y]].replace({fn:i&2?qs[fb]:qs[fn],xs:_.prefix_substitute(xs,i&1?v.data:'_'),y:(i&4?_.macroexpand:fn[x][x])(r||v)})})])]),_.define_functional/se[_('%',qs[_x.filter(_y)],qs[_,_i]),_('*',qs[_x.map(_y)],qs[_,_i]),_('/',qs[_x.foldl(_y)],qs[_,_0,_i]),_('%!',qs[_x.filter(c(_y))].replace({c:not}),qs[_,_i]),_('*!',qs[_x.each(_y)],qs[_,_i]),_('/!',qs[_x.foldr(_y)],qs[_,_0,_i]),_('&',qs[_x.forall(_y)],qs[_,_i]),_('|',qs[_x.exists(_y)],qs[_,_i]),_('-',qs[_x.flat_map(_y)],qs[_,_i]),_('>>',qs[_x.drop(_y)],qs[_]),_('<<',qs[_x.take(_y)],qs[_]),_('>>>',qs[new caterwaul.seq.infinite.y(_y,_x)],qs[_])],seq(qw('> < >= <= == !=')).each(fn[op][_.macro(qs[_+_].clone()/se[_.data=op],rxy(qs[qg[_x].size()+qg[_y].size()].clone()/se[_.data=op]))]),l[e(x)=_.macroexpand(x)] in _.macro/se[_(qs[_&&_],rxy(qse[qg[l[xp=_x][xp&&xp.size()?_y:xp]]])),_(qs[_||_],rxy(qse[qg[l[xp=_x][xp&&xp.size()?xp:_y]]])),_(qs[_===_],rxy(qs[qg[l[xp=_x,yp=_y][xp===yp||xp.size()===yp.size()&&xp.zip(yp).forall(fn[p][p[0]===p[1]])]]])),_(qs[_!==_],rxy(qs[qg[l[xp=_x,yp=_y][xp!==yp&&(xp.size()!==yp.size()||xp.zip(yp).exists(fn[p][p[0]!==p[1]]))]]])),_(qs[_^_],rxy(qs[_x.zip(_y)])),_(qs[_+_],rxy(qs[_x.concat(_y)])),_(qs[ ! _],rxy(qs[_x.object()])),_(qs[_,_],rxy(qs[_x,_y])),_(qs[ ~ _],rxy(qs[qg[new caterwaul.seq.finite(_x)]])),_(qs[_?_:_],fn[x,y,z][qs[x?y:z].replace({x:e(x),y:e(y),z:e(z)})]),l[rx(t)(x,y)=t.replace({_x:e(x),_y:y})][_(qs[_(_)],rx(qs[_x(_y)])),_(qs[_[_]],rx(qs[_x[_y]])),_(qs[_._],rx(qs[_x._y])),_(qs[_].as('('),rx(qs[qg[_x]]))],_(qs[ + _],fn[x][x]),l[rx(t)(x)=t.replace({x:x})][_(qs[N],fn_[qs[caterwaul.seq.naturals]]),_(qs[N[_]],rx(qs[caterwaul.seq.naturals_from(x)])),_(qs[n[_]],rx(qs[caterwaul.seq.n(x)]))],seq(qw('sk sv sp')).zip(qw('keys values pairs')).each(fb[p][_(qs[p[_]].replace({p:p[0]}),fn[x][qs[caterwaul.seq.finite.r(x)].replace({r:p[1],x:x})])])],this.rmacro(qs[seq[_]],_.macroexpand),where*[rxy(tree)(x,y)=tree.replace({_x:_.macroexpand(x),_y:y&&_.macroexpand(y)}),seq=fb[xs][new this.seq.finite(xs)],prepend(operator)(x)=qs[ - x].replace({x:x})/se[_.data=operator],tree_forms=l*[base=seq([qs[[_]],qs[_[_]]]),mod(fs,op)=fs.concat(fs.map(prepend(op)))] in mod(mod(base,'u-'),'u~').concat(seq([qs[ + _]])),template(op)(t)=qs[_+x].replace({x:t})/se[_.data=op],qw=caterwaul.util.qw,not=qs[qg[fn[f][fn_[ ! f.apply(this,arguments)]]]],trees_for(op)=tree_forms/re[op.charAt(op.length-1)==='!'?_.map(prepend('u!')):_]/re[_.map(template(op.replace(/!$/,'')))]]]}).configuration('seq',function(){this.configure('seq.core seq.finite.core seq.finite.object seq.finite.mutability seq.finite.traversal seq.finite.zip seq.finite.quantification '+'seq.finite.serialization seq.infinite.core seq.infinite.y seq.infinite.transform seq.infinite.traversal '+'seq.numeric seq.dsl')});caterwaul.tconfiguration('std seq','heap',function(){this.heap(less)=fc_[null]/se.c[c.prototype=new caterwaul.seq.finite()/se[_.constructor=c]/se[_.insert(x)=this.push(x).heapify_up(this.size()-1),_.root()=this[0],_.rroot()=this[0]/se[this.pop()/se[this[0]=_,this.heapify_down(0),when[this.size()]]],_.swap(i,j)=this/se[_[j]=_[i],_[i]=temp,where[temp=_[j]]],_.heapify_up(i)=this/se[_.swap(i,p).heapify_up(p),when[less.call(_,_[i],_[p])],where[p=i>>1]],_.heapify_down(i)=this/se[_.swap(lr,i).heapify_down(lr),unless[lr===i],where*[s=_.size(),r=i+1<<1,l=r-1,ll=l<s&&less.call(_,_[l],_[i])?l:i,lr=r<s&&less.call(_,_[r],_[ll])?r:ll]]]]});caterwaul.tconfiguration('std seq continuation','memoize',function(){this.namespace('memoize')/se.m[m.wrap(f)=fn_[l[as=arguments,start= + new Date()] in unwind_protect[{error:e}][{result:f.apply(this,as)}]/se[_.time= + new Date()-start]]/se[_.original=f],m.perform(result)=result.error?unwind[result.error]:result.result,m.from(proxy)=fn[f][l[state={},g=m.wrap(f)] in fn_[m.perform(proxy.call(state,this,arguments,g))]]]});caterwaul.tconfiguration('std seq continuation memoize','parser.core',function(){this.namespace('parser')/se[_.parse_state(input,i,result,memo)=undefined/se[this.input=input,this.i=i,this.result=result,this.memo=memo],_.parse_state/se.s[s.from_input(input)=new _.parse_state(input,0,null,{}),s.prototype/se[_.accept(i,r)=new this.constructor(this.input,i,r,this.memo),_.has_input()=this.i<this.input.length,_.toString()='ps[#{this.input.substr(this.i)}, #{this.result}]']],_.memoize=caterwaul.memoize.from(fn[c,as,f][k in m?m[k]:(m[k]=f.apply(c,as)),where[k='#{f.original.memo_id}|#{as[0].i}',m=as[0].memo||(as[0].memo={})]]),_.promote_non_states(f)=fn[state][state instanceof _.parse_state?f.call(this,state):f.call(this,_.parse_state.from_input(state))/re[_&&_.result]],_.identify(f)=f/se[_.memo_id=caterwaul.gensym()],_.parser(f)=_.promote_non_states(_.memoize(_.identify(f))),_.defparser(name,f)=_.parsers[name]()=_.parser(f.apply(this,arguments)),_.parsers={}]}).tconfiguration('std seq continuation','parser.c',function(){this.configure('parser.core').parser.defparser('c',fn[x,l][x.constructor===String?fn[st][st.accept(st.i+x.length,x),when[x===st.input.substr(st.i,x.length)]]:x instanceof Array?l[index=index_entries(x)] in fn[st][check_index(index,st.input,st.i)/re[_&&st.accept(st.i+_.length,_)]]:x.constructor===RegExp?l[x=add_absolute_anchors_to(x)] in fn[st][fail_length(x,st.input,st.i,l)/re[_>l&&split_lengths(x,st.input,st.i,l,_)/re[st.accept(st.i+_,x.exec(st.input.substr(st.i,_)))]]]:x.constructor===Function?fn[st][x.call(st,st.input,st.i)/re[_&&st.accept(st.i+_,st.input.substr(st.i,_))]]:l[index=index_entries(seq[sk[x]])] in fn[st][check_index(index,st.input,st.i)/re[_&&st.accept(st.i+_.length,x[_])]],where*[check_index(i,s,p)=seq[i|[_['@#{s}']&&s,where[s=s.substr(p,_.length)]]],index_entries(xs)=l*[xsp=seq[ ~ xs],ls=seq[sk[seq[ ! (xsp*[[_.length,true]])]]*[Number(_)]]] in seq[ ~ ls.slice().sort(fn[x,y][y-x])* ~ l[ ! (xsp%[_.length===l]*[['@#{_}',true]]+[['length',l]])]],add_absolute_anchors_to(x)=l[parts=/^\/(.*)\/(\w*)$/.exec(x.toString())] in new RegExp('^#{parts[1]}$',parts[2]),fail_length(re,s,p,l)=re.test(s.substr(p,l))?p+(l<<1)<=s.length?fail_length(re,s,p,l<<1):l<<1:l,split_lengths(re,s,p,l,u)=l*[b(l,u)=l+1<u?(l+(u-l>>1))/re.m[re.test(s.substr(p,m))?b(m,u):b(l,m)]:l] in b(l,u)]])}).tconfiguration('std opt seq continuation','parser.seq',function(){this.configure('parser.core').parser.defparser('seq',fn_[l[as=arguments] in fn[state][call/cc[fn[cc][opt.unroll[i,as.length][(state=as[i](state))?result.push(state.result):cc(false)],state.accept(state.i,result)]],where[result=[]]]])}).tconfiguration('std seq','parser.alt',function(){this.configure('parser.core').parser.defparser('alt',fn_[l[as=seq[ ~ arguments]] in fn[state][seq[as|[_(state)]]]])}).tconfiguration('std opt seq continuation','parser.times',function(){this.configure('parser.core').parser.defparser('times',fn[p,lower,upper][fn[state][call/cc[fn[cc][opt.unroll[i,lower][ ++ count,(state=p(state))?result.push(state.result):cc(false)],true]]&&call/cc[l*[loop(cc)=( ! upper||count ++ <upper)&&state.has_input()&&p(state)/se[state=_,when[_]]?result.push(state.result)&&call/tail[loop(cc)]:cc(state.accept(state.i,result))] in loop],where[count=0,result=[]]]])}).tconfiguration('std seq continuation','parser.opt',function(){this.configure('parser.core').parser.defparser('opt',fn[p][fn[state][state.accept(n,r),where*[s=p(state),n=s?s.i:state.i,r=s&&s.result]]])}).tconfiguration('std seq continuation','parser.match',function(){this.configure('parser.core').parser/se[_.defparser('match',fn[p][fn[state][p(state)/re[_&&state.accept(state.i,state.result)]]]),_.defparser('reject',fn[p][fn[state][p(state)/re[ ! _&&state.accept(state.i,null)]]])]}).tconfiguration('std seq continuation','parser.bind',function(){this.configure('parser.core').parser/se[_.defparser('bind',fn[p,f][fn[state][p(state)/re[_&&_.accept(_.i,f.call(_,_.result))]]])]}).tconfiguration('std seq continuation','parser.dsl',function(){this.configure('parser.core').rmacro(qs[peg[_]],fn[x][qs[qg[l*[_bindings][_parser]]].replace({_bindings:new this.syntax(',',seq[sp[this.parser.parsers]*[qs[_x=_y].replace({_x:_[0],_y:new outer.ref(_[1])})]]),_parser:this.parser.dsl.macroexpand(x)}),where[outer=this]]),this.parser.dsl=caterwaul.global().clone()/se.dsl[dsl.macro/se[_(qs[_(_)],fn[x,y][qs[_x(_y)].replace({_x:e(x),_y:y})]),_(qs[_/_],fb('/','alt')),_(qs[_%_],fb('%','seq')),_(qs[_>>_],b('bind')),_(qs[[_]],u('opt')),_(qs[_].as('('),fn[x][e(x).as('(')]),_(qs[_[_]],fn[x,l][qs[times(_x,_l)].replace({_x:e(x),_l:l})]),_(qs[_[_,_]],fn[x,l,u][qs[times(_x,_l,_u)].replace({_x:e(x),_l:l,_u:u})]),where*[e=dsl.macroexpand,fb(op,name)(x,y)=qs[_name(_x,_y)].replace({_name:name,_x:x.flatten(op).map(e)/se[_.data=','],_y:e(y)}),b(name)(x,y)=qs[_name(_x,_y)].replace({_name:name,_x:e(x),_y:y}),u(name)(x)=qs[_name(_x)].replace({_name:name,_x:e(x)})]]]}).configuration('parser',function(){this.configure('parser.core parser.c parser.seq parser.alt parser.times parser.opt parser.match parser.bind parser.dsl')});